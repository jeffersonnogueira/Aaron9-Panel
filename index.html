<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>AARON 9 – Painel Institucional em Tempo Real</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #020617;
      --card: #020617;
      --card-border: #1f2937;
      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.12);
      --danger: #f97373;
      --success: #4ade80;
      --text-soft: #9ca3af;
      --text-main: #e5e7eb;
      --error: #f97373;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #020617 0, #020617 45%, #000 100%);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .page {
      flex: 1;
      max-width: 1480px;
      margin: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* TOPO / HEADER */

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(34, 211, 238, 0.12), transparent 55%);
      border: 1px solid rgba(31, 41, 55, 0.95);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.85);
      position: relative;
      overflow: hidden;
    }

    .top-bar::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 0 0, rgba(34, 211, 238, 0.3), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(59, 130, 246, 0.25), transparent 60%);
      opacity: 0.75;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .top-left,
    .top-right {
      position: relative;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 14px;
      align-items: center;
    }

    .brand-title {
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-size: 12px;
      color: var(--text-soft);
    }

    .brand-title span {
      color: var(--accent);
    }

    .status-dot-live {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(248, 113, 113, 0.12);
      border: 1px solid rgba(248, 113, 113, 0.5);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #fecaca;
    }

    .status-dot-live::before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #f97373;
      box-shadow: 0 0 14px rgba(239, 68, 68, 0.9);
    }

    .pill-small {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 11px;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .pill-small strong {
      color: var(--text-main);
      font-weight: 500;
      margin-left: 3px;
    }

    .pill-state {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34, 211, 238, 0.8);
      background: rgba(8, 47, 73, 0.85);
      color: #e0f2fe;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      gap: 6px;
      white-space: nowrap;
    }

    .pill-state::before {
      content: "";
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22d3ee;
      box-shadow: 0 0 12px rgba(34, 211, 238, 0.9);
    }

    .pill-soft {
      display: inline-flex;
      align-items: center;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.85);
      font-size: 11px;
      color: var(--text-soft);
      white-space: nowrap;
    }

    .pill-soft strong {
      color: var(--text-main);
      font-weight: 500;
      margin-left: 4px;
    }

    .pill-soft-accent {
      border-color: rgba(34, 211, 238, 0.85);
      color: #e0f2fe;
    }

    .btn-refresh {
      position: relative;
      z-index: 1;
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid rgba(34, 211, 238, 0.7);
      background: radial-gradient(circle at top, rgba(34, 211, 238, 0.2), rgba(15, 23, 42, 0.9));
      color: #e0f2fe;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      display: inline-flex;
      gap: 6px;
      align-items: center;
      cursor: pointer;
    }

    .btn-refresh::before {
      content: "⟳";
      font-size: 12px;
    }

    .btn-refresh[disabled] {
      opacity: 0.5;
      cursor: default;
    }

    /* BANNER ERRO */

    .error-banner {
      display: none;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(248, 113, 113, 0.8);
      background: rgba(127, 29, 29, 0.3);
      color: #fecaca;
      font-size: 12px;
    }

    .error-banner strong {
      color: #fee2e2;
    }

    /* LAYOUT PRINCIPAL */

    .layout {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
      gap: 12px;
      align-items: flex-start;
    }

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card {
      position: relative;
      border-radius: 16px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(3, 7, 18, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.9);
      box-shadow:
        0 18px 42px rgba(15, 23, 42, 0.95),
        0 0 28px rgba(15, 23, 42, 0.9);
      padding: 12px 14px;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(34, 211, 238, 0.12), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .card-header {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .badge-outline {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      gap: 6px;
    }

    .badge-outline.green {
      border-color: rgba(74, 222, 128, 0.8);
      color: #bbf7d0;
    }

    .badge-outline.red {
      border-color: rgba(248, 113, 113, 0.8);
      color: #fecaca;
    }

    .badge-outline span.dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: currentColor;
      box-shadow: 0 0 10px currentColor;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.4fr);
      gap: 10px;
    }

    .panel-section {
      position: relative;
      z-index: 1;
      padding: 10px 10px 10px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(30, 64, 175, 0.8);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
      margin-bottom: 8px;
    }

    .panel-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .panel-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 11px;
      color: var(--text-main);
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .pill-green {
      border-color: rgba(74, 222, 128, 0.8);
      color: var(--success);
    }

    .pill-red {
      border-color: rgba(248, 113, 113, 0.8);
      color: var(--danger);
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
      margin-bottom: 2px;
    }

    /* === DIREÇÃO COM FLECHA === */
    .direction-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .arrow-badge {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(34, 211, 238, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 18px rgba(34, 211, 238, 0.7);
      font-size: 24px;
      font-weight: 700;
      color: #e5e7eb;
      flex-shrink: 0;
    }

    .arrow-badge.arrow-up {
      border-color: rgba(74, 222, 128, 0.9);
      box-shadow: 0 0 22px rgba(74, 222, 128, 0.8);
      color: #4ade80;
    }

    .arrow-badge.arrow-down {
      border-color: rgba(248, 113, 113, 0.9);
      box-shadow: 0 0 22px rgba(248, 113, 113, 0.85);
      color: #f97373;
    }

    .direction-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 11px;
    }

    .direction-text strong {
      font-size: 13px;
    }

    .text-soft {
      color: var(--text-soft);
    }
    /* ====== AARON 9 – COLUNA DIREITA (DECISION PANEL) ====== */

.decision-column {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.decision-card {
  background: var(--card, #020617);
  border-radius: 18px;
  border: 1px solid var(--card-border, #1f2937);
  padding: 16px 18px;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
}

/* títulos e textos pequenos */
.decision-title {
  font-size: 0.75rem;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--text-soft, #9ca3af);
  margin-bottom: 8px;
}

.decision-label-strong {
  font-size: 1.05rem;
  font-weight: 600;
  color: var(--text-main, #e5e7eb);
}

/* radar de direção */
.radar-header {
  display: flex;
  align-items: center;
  gap: 12px;
}

.radar-circle {
  width: 54px;
  height: 54px;
  border-radius: 999px;
  border: 2px solid #f97373;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
}

.radar-circle.buy {
  border-color: var(--accent, #22d3ee);
}

.radar-percent {
  font-size: 0.9rem;
  color: var(--text-soft, #9ca3af);
}

/* barrinhas horizontal (a favor x contra, etc.) */
.decision-bar {
  position: relative;
  width: 100%;
  height: 6px;
  border-radius: 999px;
  background: rgba(148, 163, 184, 0.18);
  overflow: hidden;
}

.decision-bar-fill {
  position: absolute;
  inset: 0;
  width: 70%; /* será ajustado depois com JS ou no backend */
  border-radius: inherit;
  background: linear-gradient(90deg, #22c55e, #facc15);
}

.decision-bar-fill-danger {
  position: absolute;
  inset: 0;
  width: 30%;
  border-radius: inherit;
  background: linear-gradient(90deg, #f97373, #facc15);
}

/* pill do estado (NO TRADE / GO FULL etc.) */
.decision-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 3px 10px;
  border-radius: 999px;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.16em;
  text-transform: uppercase;
}

.decision-pill.go-full {
  background: rgba(248, 113, 113, 0.16);
  color: #fecaca;
}

.decision-pill.scalp {
  background: rgba(56, 189, 248, 0.16);
  color: #bae6fd;
}

.decision-pill.wait {
  background: rgba(234, 179, 8, 0.16);
  color: #facc15;
}

.decision-pill.no-trade {
  background: rgba(148, 163, 184, 0.16);
  color: #cbd5f5;
}

/* checklist de padrões */
.checklist-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.check-pill {
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 0.8rem;
  border: 1px solid rgba(148, 163, 184, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
}

.check-pill.on {
  border-color: rgba(45, 212, 191, 0.9);
  background: rgba(34, 197, 94, 0.12);
  color: #bbf7d0;
}

/* pattern radar + pullback */
.pattern-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.5fr);
  gap: 12px;
}

.pattern-box {
  border-radius: 14px;
  border: 1px solid rgba(148, 163, 184, 0.4);
  padding: 8px 10px;
  font-size: 0.78rem;
}

.pattern-name {
  font-weight: 600;
  margin-bottom: 4px;
}

.pullback-highlight {
  font-size: 0.78rem;
  margin-top: 8px;
  padding: 6px 8px;
  border-radius: 10px;
  background: rgba(34, 197, 94, 0.08);
  border: 1px solid rgba(34, 197, 94, 0.4);
}

/* responsivo: em telas estreitas essa coluna vira full-width */
@media (max-width: 1024px) {
  .decision-column {
    margin-top: 16px;
  }
}
/* ====== HERO STATUS (MODO CEGO) ====== */

.status-hero {
  background: radial-gradient(circle at top left, rgba(34,197,94,0.18), rgba(15,23,42,1));
  border-radius: 20px;
  border: 1px solid rgba(34,197,94,0.7);
  padding: 14px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
}

.status-hero-label {
  font-size: 0.7rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: rgba(148,163,184,0.9);
}

.status-hero-main {
  font-size: 1.35rem;
  font-weight: 700;
  color: #e5e7eb;
}

.status-hero-sub {
  font-size: 0.8rem;
  color: var(--text-soft, #9ca3af);
}

/* bolha da direita (GO FULL / WAIT etc.) */
.status-hero-badge {
  min-width: 88px;
  text-align: center;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 700;
  letter-spacing: 0.18em;
  text-transform: uppercase;
}

/* cores por estado */
.status-buy {
  background: radial-gradient(circle at top left, rgba(34,197,94,0.22), #020617);
  border-color: rgba(34,197,94,0.8);
}

.status-sell {
  background: radial-gradient(circle at top left, rgba(248,113,113,0.22), #020617);
  border-color: rgba(248,113,113,0.9);
}

.status-wait {
  background: radial-gradient(circle at top left, rgba(234,179,8,0.22), #020617);
  border-color: rgba(234,179,8,0.9);
}

.status-no-trade {
  background: radial-gradient(circle at top left, rgba(148,163,184,0.22), #020617);
  border-color: rgba(148,163,184,0.9);
}

/* cores da badge */
.status-hero-badge.buy { background: rgba(34,197,94,0.18); color:#bbf7d0; }
.status-hero-badge.sell { background: rgba(248,113,113,0.18); color:#fecaca; }
.status-hero-badge.wait { background: rgba(234,179,8,0.18); color:#facc15; }
.status-hero-badge.no-trade { background: rgba(148,163,184,0.18); color:#e5e7eb; }

/* piscando leve para EXECUTAR AGORA */
.blink-hero {
  animation: heroPulse 1.4s ease-in-out infinite;
}

@keyframes heroPulse {
  0%   { transform: scale(1); box-shadow: 0 0 0 0 rgba(248,113,113,0.7); }
  50%  { transform: scale(1.01); box-shadow: 0 0 0 12px rgba(248,113,113,0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(248,113,113,0); }
}

/* ====== PATTERN DRAWINGS (PADRÃO DO DIA / MOMENTO) ====== */

.pattern-canvas {
  background: rgba(15,23,42,0.9);
  border-radius: 10px;
  padding: 4px 6px;
  margin-bottom: 6px;
  border: 1px solid rgba(148,163,184,0.35);
}

.pattern-svg {
  width: 100%;
  height: 34px;
}

.prob-phrase {
  font-size: 0.76rem;
  margin-top: 4px;
  color: var(--text-soft, #9ca3af);
}

.prob-phrase.favor {
  color: #bbf7d0;
}

.prob-phrase.contra {
  color: #fecaca;
}

  </style>
</head>

<body>
  <div class="page">
    <!-- ====== TOPO ====== -->
    <header class="top-bar">
      <div class="top-left">
        <div class="brand-title">
          <span>AARON 9</span>&nbsp;INSTITUTIONAL PANEL
        </div>
        <div class="status-dot-live">LIVE FEED</div>
        <div class="pill-small">
          Símbolo <strong id="symbol-label">—</strong>
        </div>
        <div class="pill-small">
          Timeframe <strong id="timeframe-label">—</strong>
        </div>
        <div class="pill-small">
          Sessão <strong id="session-label">—</strong>
        </div>
      </div>

      <div class="top-right">
        <div class="pill-state" id="state-pill">AGUARDANDO</div>
        <div class="pill-soft">
          Última atualização:
          <strong id="last-update-label">—</strong>
        </div>
        <button class="btn-refresh" id="btn-refresh">ATUALIZAR</button>
      </div>
    </header>

    <div id="error-banner" class="error-banner">
      <strong>Erro ao carregar painel.</strong> Verifique o n8n / webhook e tente novamente.
    </div>

    <!-- ====== LAYOUT PRINCIPAL ====== -->
    <main class="layout">
      <!-- ====== COLUNA ESQUERDA: TV + PADRÕES ====== -->
      <section class="column">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Painel de Preço em Tempo Real</div>
              <div class="card-subtitle">TradingView + Estrutura do Dia</div>
            </div>
            <div class="badge-outline green">
              <span class="dot"></span>
              Fluxo
              <span id="flow-label">Neutro</span>
            </div>
          </div>

          <!-- Padrão do dia -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Direção do Dia</div>
              <div class="pill" id="trend-day-pill">Aguardando primeiro alerta</div>
            </div>

            <div class="direction-row">
              <div id="direction-day-arrow" class="arrow-badge">↕</div>
              <div class="direction-text">
                <div class="row" style="justify-content: flex-start;">
                  <span style="color: var(--text-soft); text-transform: uppercase; letter-spacing: 0.16em; font-size: 10px;">
                    Padrão institucional do dia
                  </span>
                </div>
                <div class="row" style="justify-content: flex-start;">
                  <strong id="pattern-day-label">-</strong>
                </div>
                <div class="row" style="justify-content: flex-start;">
                  <span id="pattern-day-detail" class="text-soft">
                    Aguardando dados...
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Padrão do momento / últimos 50 candles -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Padrão do Momento (Últimos 50 candles)</div>
              <div class="pill" id="trend-now-pill">Aguardando</div>
            </div>

            <div class="direction-row">
              <div id="direction-now-arrow" class="arrow-badge">↕</div>
              <div class="direction-text">
                <div class="row" style="justify-content: flex-start;">
                  <strong id="pattern-now-label">-</strong>
                </div>
                <div class="row" style="justify-content: flex-start;">
                  <span id="pattern-now-detail" class="text-soft">
                    Aguardando entrada...
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- TRADINGVIEW -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Gráfico em Tempo Real</div>
              <div class="pill-soft pill-soft-accent">
                Fonte: TradingView
              </div>
            </div>
            <div style="border-radius: 10px; overflow: hidden; border: 1px solid rgba(15,23,42,0.9); min-height: 420px;">
              <iframe
                id="tv-iframe"
                src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_fcf9d&symbol=NASDAQ%3ANVDA&interval=1&hidesidetoolbar=1&symboledit=1&saveimage=0&theme=dark&style=1&timezone=exchange"
                style="width: 100%; height: 430px; border: none;"
                loading="lazy"
                allowtransparency="true"
                scrolling="no">
              </iframe>
            </div>
          </div>
        </div>
      </section>

      <!-- ====== COLUNA DIREITA: RESUMO + RISCO ====== -->
      <section class="column">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Resumo Institucional</div>
              <div class="card-subtitle">Leitura consolidada do AARON 9</div>
            </div>
            <div class="badge-outline">
              <span class="dot"></span>
              Gestão de risco
            </div>
          </div>
<!-- ====== AARON 9 – COLUNA DIREITA (DECISION PANEL) ====== -->
<div class="decision-column">

  <!-- RADAR VISUAL DE DIREÇÃO -->
  <section class="decision-card">
    <div class="decision-title">Direção geral do dia</div>
    <div class="radar-header">
      <div class="radar-circle">
        <!-- seta pra baixo ou pra cima -->
        ↓
      </div>
      <div>
        <div class="decision-label-strong">Baixa forte</div>
        <div class="radar-percent">70% · baseada em tendência, volatilidade e memória A8/A9.</div>
      </div>
    </div>

    <hr style="border: none; border-top: 1px solid rgba(148,163,184,0.18); margin: 12px 0;" />

    <div class="decision-title">Direção prevista · 1–3 candles</div>
    <div class="radar-header">
      <div class="radar-circle buy">
        ↑
      </div>
      <div>
        <div class="decision-label-strong">Baixa</div>
        <div class="radar-percent">65% · fluxo geral puxa movimentos de baixa. Contexto favorece vendas.</div>
      </div>
    </div>
  </section>
<!-- HERO STATUS – MODO CEGO -->
<section id="hero-block" class="status-hero status-sell blink-hero">
  <div>
    <div class="status-hero-label">Modo cego – decisão atual</div>
    <div id="hero-main" class="status-hero-main">EXECUTAR VENDA</div>
    <div id="hero-sub" class="status-hero-sub">
      Cenário forte de venda na janela institucional. Pullback em zona, risco moderado.
    </div>
  </div>
  <div id="hero-badge" class="status-hero-badge sell">
    GO FULL
  </div>
</section>


  <!-- RESUMO INSTITUCIONAL / VEREDITO -->
  <section class="decision-card">
    <div class="decision-title">Resumo institucional</div>
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px;">
      <span class="decision-pill go-full">GO FULL</span>
      <span class="decision-label-strong">VENDA</span>
    </div>

    <div style="font-size:0.8rem; margin-bottom:10px; color:var(--text-soft);">
      Cenário forte de venda na janela institucional. Pullback em zona, risco moderado.
    </div>

    <div style="font-size:0.78rem; margin-bottom:4px;">A favor: 78%</div>
    <div class="decision-bar">
      <div class="decision-bar-fill" style="width:78%;"></div>
    </div>

    <div style="font-size:0.78rem; margin:10px 0 4px;">Contra: 22%</div>
    <div class="decision-bar">
      <div class="decision-bar-fill-danger" style="width:22%;"></div>
    </div>
<div class="prob-phrase favor">
  Continuação muito provável; fluxo bem alinhado com a direção atual. Operar a favor é mais seguro que ir contra.
</div>

<div class="prob-phrase contra">
  Probabilidade moderada de reação contra ainda existe; evite alavancagem exagerada e respeite o stop.
</div>

    <div style="display:flex; gap:10px; margin-top:12px; font-size:0.78rem;">
      <div>
        <div class="decision-title" style="margin-bottom:2px;">Risco</div>
        <div>Moderado</div>
      </div>
      <div>
        <div class="decision-title" style="margin-bottom:2px;">Contexto</div>
        <div>Vulcão · 7:30–8:45</div>
      </div>
      <div>
        <div class="decision-title" style="margin-bottom:2px;">Execução</div>
        <div>Executar venda</div>
      </div>
    </div>
  </section>

  <!-- CHECKLIST DE PADRÕES -->
  <section class="decision-card">
    <div class="decision-title">Checklist de padrões</div>
    <div class="checklist-grid">
      <div class="check-pill on">Rompimento</div>
      <div class="check-pill">Continuação</div>
      <div class="check-pill">Reversão (ausente)</div>
      <div class="check-pill on">Divergência</div>
      <div class="check-pill">Exaustão</div>
      <div class="check-pill">Volume normal</div>
    </div>
  </section>

  <!-- PATTERN RADAR + CHECK PULLBACK -->
  <section class="decision-card">
  <div class="decision-title">Pattern radar · estrutura</div>

  <div class="pattern-layout" style="margin-top:6px;">

    <!-- PADRÃO DO DIA -->
    <div class="pattern-box">
      <div class="decision-title" style="margin-bottom:4px;">Padrão do dia</div>

      <div class="pattern-canvas">
        <!-- Desenho simbólico do padrão do dia (ex.: canal de baixa) -->
        <svg class="pattern-svg" viewBox="0 0 100 36">
          <polyline
            points="0,10 20,16 40,20 60,24 80,28 100,32"
            fill="none"
            stroke="rgba(248,113,113,0.9)"
            stroke-width="2.2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>

      <div class="pattern-name">Canal de baixa moderada</div>
      <div>
        Preço respeitando topos e fundos descendentes durante o dia. Favorece operações a favor da tendência de baixa.
      </div>
    </div>

    <!-- PADRÃO DO MOMENTO (últimos 50 candles) -->
    <div class="pattern-box">
      <div class="decision-title" style="margin-bottom:4px;">Padrão do momento · últimos 50 candles</div>

      <div class="pattern-canvas">
        <!-- Desenho simbólico do padrão do momento (ex.: range / zigue-zague) -->
        <svg class="pattern-svg" viewBox="0 0 100 36">
          <polyline
            points="0,26 15,10 30,24 45,12 60,22 75,8 90,20 100,14"
            fill="none"
            stroke="rgba(56,189,248,0.9)"
            stroke-width="2.2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>

      <div class="pattern-name">Range / consolidação ativa</div>
      <div>
        Mercado alternando entre suporte e resistência nos últimos candles. Melhor aguardar rompimento ou pullback bem claro.
      </div>
    </div>

  </div>


    <!-- Check de pullback / respiro -->
    <div class="pullback-highlight">
      <div style="font-weight:600; margin-bottom:4px;">Check de pullback</div>
      <div style="font-size:0.78rem;">
        ATR do candle atual: <strong>0.85</strong> · Profundidade: <strong>0.96 ATR</strong><br />
        Tendência: <strong>Baixa forte</strong> · Estrutura: <strong>LH</strong><br />
        Pullback dentro da faixa ideal. Continuação provável se o contexto se mantiver.
      </div>
    </div>
  </section>

</div>

          <!-- Comentário principal -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Comentário do Painel</div>
            </div>
            <div class="row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
              <div id="summary-text" style="font-size: 12px; line-height: 1.5; color: var(--text-main);">
                Aguardando primeiro alerta do TradingView para montar o painel...
              </div>
            </div>
          </div>

          <!-- Risco + Contexto -->
          <div class="grid-2">
            <div class="panel-section">
              <div class="panel-section-header">
                <div class="panel-section-title">Risco</div>
              </div>
              <div class="row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <div class="pill" id="risk-pill">Neutro</div>
                <div id="risk-text" style="font-size: 12px; color: var(--text-soft);">
                  —
                </div>
              </div>
            </div>

            <div class="panel-section">
              <div class="panel-section-header">
                <div class="panel-section-title">Contexto</div>
              </div>
              <div class="row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <div id="context-text" style="font-size: 12px; color: var(--text-soft);">
                  —
                </div>
              </div>
            </div>
          </div>

          <!-- Execução -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Execução</div>
            </div>
            <div id="execution-text" style="font-size: 12px; color: var(--text-soft);">
              —
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ======= CONFIG PAINEL (JSON) =======
    // Troque o URL se você alterar o webhook no n8n.
    const PANEL_URL = 'https://jjjnogueira.app.n8n.cloud/webhook/aaron9-json';
    const REFRESH_MS = 60000; // 1 minuto

    const els = {
      errorBanner: document.getElementById('error-banner'),
      btnRefresh: document.getElementById('btn-refresh'),
      state: document.getElementById('state-pill'),
      symbol: document.getElementById('symbol-label'),
      timeframe: document.getElementById('timeframe-label'),
      session: document.getElementById('session-label'),
      lastUpdate: document.getElementById('last-update-label'),
      flow: document.getElementById('flow-label'),
      trendDayPill: document.getElementById('trend-day-pill'),
      trendNowPill: document.getElementById('trend-now-pill'),
      dirDayArrow: document.getElementById('direction-day-arrow'),
      dirNowArrow: document.getElementById('direction-now-arrow'),
      patternDayLabel: document.getElementById('pattern-day-label'),
      patternDayDetail: document.getElementById('pattern-day-detail'),
      patternNowLabel: document.getElementById('pattern-now-label'),
      patternNowDetail: document.getElementById('pattern-now-detail'),
      summary: document.getElementById('summary-text'),
      riskPill: document.getElementById('risk-pill'),
      riskText: document.getElementById('risk-text'),
      contextText: document.getElementById('context-text'),
      executionText: document.getElementById('execution-text'),
    };

    function safeText(el, value, fallback = '—') {
      if (!el) return;
      el.textContent =
        value === undefined || value === null || value === '' ? fallback : String(value);
    }

    function setArrow(el, dir) {
      if (!el) return;
      el.classList.remove('arrow-up', 'arrow-down');
      let symbol = '↕';
      if (dir === 'up' || dir === 'UP' || dir === 'alta') {
        el.classList.add('arrow-up');
        symbol = '↑';
      } else if (dir === 'down' || dir === 'DOWN' || dir === 'baixa') {
        el.classList.add('arrow-down');
        symbol = '↓';
      }
      el.textContent = symbol;
    }

    function setPillTrend(el, dir, label) {
      if (!el) return;
      el.classList.remove('pill-green', 'pill-red');
      let txt = label || 'Neutro';
      if (dir === 'up' || dir === 'UP' || dir === 'alta') {
        el.classList.add('pill-green');
        if (!label) txt = 'Fluxo de alta';
      } else if (dir === 'down' || dir === 'DOWN' || dir === 'baixa') {
        el.classList.add('pill-red');
        if (!label) txt = 'Fluxo de baixa';
      }
      el.textContent = txt;
    }

    function setRiskPill(level) {
      if (!els.riskPill) return;
      const el = els.riskPill;
      el.classList.remove('pill-green', 'pill-red');
      let txt = 'Neutro';
      if (!level) {
        el.textContent = txt;
        return;
      }
      const l = String(level).toLowerCase();
      if (l.includes('alto') || l.includes('high')) {
        el.classList.add('pill-red');
        txt = 'Risco Alto';
      } else if (l.includes('baixo') || l.includes('low')) {
        el.classList.add('pill-green');
        txt = 'Risco Baixo';
      } else {
        txt = level;
      }
      el.textContent = txt;
    }

    async function loadPanel(showSpinner) {
      if (!PANEL_URL) return;
      try {
        if (els.errorBanner) els.errorBanner.style.display = 'none';
        if (els.btnRefresh && showSpinner) els.btnRefresh.disabled = true;

        const res = await fetch(PANEL_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const panel = await res.json();

        const {
          symbol,
          timeframe,
          session,
          flow_label,
          status,
          meta,
          pattern_day,
          pattern_day_detail,
          pattern_now,
          pattern_now_detail,
          direction_day,
          direction_now,
          summary,
          risk_level,
          risk_comment,
          context_comment,
          execution_plan,
        } = panel || {};

        safeText(els.symbol, symbol);
        safeText(els.timeframe, timeframe || panel?.timeframe_label);
        safeText(els.session, session || panel?.session_label);
        safeText(els.flow, flow_label || panel?.flow || 'Neutro');

        const stateText = status?.label || status?.state || 'ONLINE';
        safeText(els.state, stateText);

        const ts = meta?.panel_ts || meta?.timestamp || panel?.timestamp;
        if (els.lastUpdate) {
          if (!ts) {
            els.lastUpdate.textContent = 'sem timestamp';
          } else {
            try {
              const d =
                typeof ts === 'number'
                  ? new Date(ts)
                  : new Date(String(ts));
              els.lastUpdate.textContent = d.toLocaleString('pt-BR', {
                timeZone: 'America/Denver',
              });
            } catch (e) {
              els.lastUpdate.textContent = String(ts);
            }
          }
        }

        // Padrões / Direções
        safeText(els.patternDayLabel, pattern_day || panel?.pattern_of_day || '-');
        safeText(
          els.patternDayDetail,
          pattern_day_detail || panel?.pattern_of_day_detail || '—'
        );
        safeText(els.patternNowLabel, pattern_now || panel?.pattern_of_moment || '-');
        safeText(
          els.patternNowDetail,
          pattern_now_detail || panel?.pattern_of_moment_detail || '—'
        );

        setArrow(els.dirDayArrow, direction_day || panel?.direction_of_day);
        setArrow(els.dirNowArrow, direction_now || panel?.direction_of_moment);

        setPillTrend(
          els.trendDayPill,
          direction_day || panel?.direction_of_day,
          panel?.trend_day_label
        );
        setPillTrend(
          els.trendNowPill,
          direction_now || panel?.direction_of_moment,
          panel?.trend_now_label
        );

        safeText(els.summary, summary || panel?.summary || '—');
        setRiskPill(risk_level || panel?.risk_level);
        safeText(els.riskText, risk_comment || panel?.risk_comment || '—');
        safeText(els.contextText, context_comment || panel?.context_comment || '—');
        safeText(els.executionText, execution_plan || panel?.execution_plan || '—');
      } catch (err) {
        console.error('Erro ao carregar painel', err);
        if (els.errorBanner) {
          els.errorBanner.style.display = 'block';
          els.errorBanner.innerHTML =
            '<strong>Erro ao carregar painel.</strong> Verifique o webhook "aaron9-json" no n8n e tente novamente.';
        }
      } finally {
        if (els.btnRefresh) els.btnRefresh.disabled = false;
      }
    }

    if (els.btnRefresh) {
      els.btnRefresh.addEventListener('click', function () {
        loadPanel(true);
      });
    }

    loadPanel(false);
    setInterval(loadPanel, REFRESH_MS);
  </script>
</body>
</html>
