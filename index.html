<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>AARON 9 – Painel Institucional em Tempo Real</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #020617;
      --card: #020617;
      --card-border: #1f2937;
      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.12);
      --danger: #f97373;
      --success: #4ade80;
      --text-soft: #9ca3af;
      --text-main: #e5e7eb;
      --error: #f97373;
    }

    * {
      box-sizing: border-box;
    }

    body {
  margin: 0;
  padding: 0;
  background: #020617;
  color: var(--text-main);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

/* wrapper principal da página */
.app-shell {
  min-height: 100vh;
  display: flex;
  justify-content: flex-start;  /* fica encostado à esquerda */
}

.app-inner {
  width: 100%;
  max-width: 100%;              /* tira o limite de 1680px */
  margin: 16px 24px 32px 24px;  /* margens finas só pra não colar na borda */
}


 .page {
  flex: 1;
  max-width: 1480px;          /* largura máxima do painel */
  width: 100%;
  margin: 16px auto 32px auto;/* auto nas laterais = CENTRALIZA */
  display: flex;
  flex-direction: column;
  gap: 10px;
}



    /* TOPO / HEADER */

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(34, 211, 238, 0.12), transparent 55%);
      border: 1px solid rgba(31, 41, 55, 0.95);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.85);
      position: relative;
      overflow: hidden;
    }

    .top-bar::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 0 0, rgba(34, 211, 238, 0.3), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(59, 130, 246, 0.25), transparent 60%);
      opacity: 0.75;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .top-left,
    .top-right {
      position: relative;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 14px;
      align-items: center;
    }

    .brand-title {
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-size: 12px;
      color: var(--text-soft);
    }

    .brand-title span {
      color: var(--accent);
    }

    .status-dot-live {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(248, 113, 113, 0.12);
      border: 1px solid rgba(248, 113, 113, 0.5);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #fecaca;
    }

    .status-dot-live::before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #f97373;
      box-shadow: 0 0 14px rgba(239, 68, 68, 0.9);
    }

    .pill-small {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 11px;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .pill-small strong {
      color: var(--text-main);
      font-weight: 500;
      margin-left: 3px;
    }

    .pill-state {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34, 211, 238, 0.8);
      background: rgba(8, 47, 73, 0.85);
      color: #e0f2fe;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      gap: 6px;
      white-space: nowrap;
    }

    .pill-state::before {
      content: "";
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22d3ee;
      box-shadow: 0 0 12px rgba(34, 211, 238, 0.9);
    }

    .pill-soft {
      display: inline-flex;
      align-items: center;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.85);
      font-size: 11px;
      color: var(--text-soft);
      white-space: nowrap;
    }

    .pill-soft strong {
      color: var(--text-main);
      font-weight: 500;
      margin-left: 4px;
    }

    .pill-soft-accent {
      border-color: rgba(34, 211, 238, 0.85);
      color: #e0f2fe;
    }

    .btn-refresh {
      position: relative;
      z-index: 1;
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid rgba(34, 211, 238, 0.7);
      background: radial-gradient(circle at top, rgba(34, 211, 238, 0.2), rgba(15, 23, 42, 0.9));
      color: #e0f2fe;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      display: inline-flex;
      gap: 6px;
      align-items: center;
      cursor: pointer;
    }

    .btn-refresh::before {
      content: "⟳";
      font-size: 12px;
    }

    .btn-refresh[disabled] {
      opacity: 0.5;
      cursor: default;
    }

    /* BANNER ERRO */

    .error-banner {
      display: none;
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(248, 113, 113, 0.8);
      background: rgba(127, 29, 29, 0.3);
      color: #fecaca;
      font-size: 12px;
    }

    .error-banner strong {
      color: #fee2e2;
    }

    /* LAYOUT PRINCIPAL */

    .layout {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
      gap: 12px;
      align-items: flex-start;
    }

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .card {
      position: relative;
      border-radius: 16px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(3, 7, 18, 0.98));
      border: 1px solid rgba(30, 64, 175, 0.9);
      box-shadow:
        0 18px 42px rgba(15, 23, 42, 0.95),
        0 0 28px rgba(15, 23, 42, 0.9);
      padding: 12px 14px;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(34, 211, 238, 0.12), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .card-header {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .badge-outline {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      gap: 6px;
    }

    .badge-outline.green {
      border-color: rgba(74, 222, 128, 0.8);
      color: #bbf7d0;
    }

    .badge-outline.red {
      border-color: rgba(248, 113, 113, 0.8);
      color: #fecaca;
    }

    .badge-outline span.dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: currentColor;
      box-shadow: 0 0 10px currentColor;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.4fr);
      gap: 10px;
    }

    .panel-section {
      position: relative;
      z-index: 1;
      padding: 10px 10px 10px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(30, 64, 175, 0.8);
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
      margin-bottom: 8px;
    }

    .panel-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .panel-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 11px;
      color: var(--text-main);
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .pill-green {
      border-color: rgba(74, 222, 128, 0.8);
      color: var(--success);
    }

    .pill-red {
      border-color: rgba(248, 113, 113, 0.8);
      color: var(--danger);
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
      margin-bottom: 2px;
    }

    /* === DIREÇÃO COM FLECHA === */
    .direction-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .arrow-badge {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(34, 211, 238, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 18px rgba(34, 211, 238, 0.7);
      font-size: 24px;
      font-weight: 700;
      color: #e5e7eb;
      flex-shrink: 0;
    }

    .arrow-badge.arrow-up {
      border-color: rgba(74, 222, 128, 0.9);
      box-shadow: 0 0 22px rgba(74, 222, 128, 0.8);
      color: #4ade80;
    }

    .arrow-badge.arrow-down {
      border-color: rgba(248, 113, 113, 0.9);
      box-shadow: 0 0 22px rgba(248, 113, 113, 0.85);
      color: #f97373;
    }

    .direction-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 11px;
    }

    .direction-text strong {
      font-size: 13px;
    }

    .text-soft {
      color: var(--text-soft);
    }
    /* ====== AARON 9 – COLUNA DIREITA (DECISION PANEL) ====== */

.decision-column {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.decision-card {
  background: var(--card, #020617);
  border-radius: 18px;
  border: 1px solid var(--card-border, #1f2937);
  padding: 16px 18px;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
}

/* títulos e textos pequenos */
.decision-title {
  font-size: 0.75rem;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--text-soft, #9ca3af);
  margin-bottom: 8px;
}

.decision-label-strong {
  font-size: 1.05rem;
  font-weight: 600;
  color: var(--text-main, #e5e7eb);
}

/* radar de direção */
.radar-header {
  display: flex;
  align-items: center;
  gap: 12px;
}

.radar-circle {
  width: 54px;
  height: 54px;
  border-radius: 999px;
  border: 2px solid #f97373;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
}

.radar-circle.buy {
  border-color: var(--accent, #22d3ee);
}

.radar-percent {
  font-size: 0.9rem;
  color: var(--text-soft, #9ca3af);
}

/* barrinhas horizontal (a favor x contra, etc.) */
.decision-bar {
  position: relative;
  width: 100%;
  height: 6px;
  border-radius: 999px;
  background: rgba(148, 163, 184, 0.18);
  overflow: hidden;
}

.decision-bar-fill {
  position: absolute;
  inset: 0;
  width: 70%; /* será ajustado depois com JS ou no backend */
  border-radius: inherit;
  background: linear-gradient(90deg, #22c55e, #facc15);
}

.decision-bar-fill-danger {
  position: absolute;
  inset: 0;
  width: 30%;
  border-radius: inherit;
  background: linear-gradient(90deg, #f97373, #facc15);
}

/* pill do estado (NO TRADE / GO FULL etc.) */
.decision-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 3px 10px;
  border-radius: 999px;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.16em;
  text-transform: uppercase;
}

.decision-pill.go-full {
  background: rgba(248, 113, 113, 0.16);
  color: #fecaca;
}

.decision-pill.scalp {
  background: rgba(56, 189, 248, 0.16);
  color: #bae6fd;
}

.decision-pill.wait {
  background: rgba(234, 179, 8, 0.16);
  color: #facc15;
}

.decision-pill.no-trade {
  background: rgba(148, 163, 184, 0.16);
  color: #cbd5f5;
}

/* checklist de padrões */
.checklist-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.check-pill {
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 0.8rem;
  border: 1px solid rgba(148, 163, 184, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
}

.check-pill.on {
  border-color: rgba(45, 212, 191, 0.9);
  background: rgba(34, 197, 94, 0.12);
  color: #bbf7d0;
}

/* pattern radar + pullback */
.pattern-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.5fr);
  gap: 12px;
}

.pattern-box {
  border-radius: 14px;
  border: 1px solid rgba(148, 163, 184, 0.4);
  padding: 8px 10px;
  font-size: 0.78rem;
}

.pattern-name {
  font-weight: 600;
  margin-bottom: 4px;
}

.pullback-highlight {
  font-size: 0.78rem;
  margin-top: 8px;
  padding: 6px 8px;
  border-radius: 10px;
  background: rgba(34, 197, 94, 0.08);
  border: 1px solid rgba(34, 197, 94, 0.4);
}

/* responsivo: em telas estreitas essa coluna vira full-width */
@media (max-width: 1024px) {
  .decision-column {
    margin-top: 16px;
  }
}
/* ====== HERO STATUS (MODO CEGO) ====== */

.status-hero {
  background: radial-gradient(circle at top left, rgba(34,197,94,0.18), rgba(15,23,42,1));
  border-radius: 20px;
  border: 1px solid rgba(34,197,94,0.7);
  padding: 14px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
}

.status-hero-label {
  font-size: 0.7rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: rgba(148,163,184,0.9);
}

.status-hero-main {
  font-size: 1.35rem;
  font-weight: 700;
  color: #e5e7eb;
}

.status-hero-sub {
  font-size: 0.8rem;
  color: var(--text-soft, #9ca3af);
}

/* bolha da direita (GO FULL / WAIT etc.) */
.status-hero-badge {
  min-width: 88px;
  text-align: center;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 700;
  letter-spacing: 0.18em;
  text-transform: uppercase;
}

/* cores por estado */
.status-buy {
  background: radial-gradient(circle at top left, rgba(34,197,94,0.22), #020617);
  border-color: rgba(34,197,94,0.8);
}

.status-sell {
  background: radial-gradient(circle at top left, rgba(248,113,113,0.22), #020617);
  border-color: rgba(248,113,113,0.9);
}

.status-wait {
  background: radial-gradient(circle at top left, rgba(234,179,8,0.22), #020617);
  border-color: rgba(234,179,8,0.9);
}

.status-no-trade {
  background: radial-gradient(circle at top left, rgba(148,163,184,0.22), #020617);
  border-color: rgba(148,163,184,0.9);
}

/* cores da badge */
.status-hero-badge.buy { background: rgba(34,197,94,0.18); color:#bbf7d0; }
.status-hero-badge.sell { background: rgba(248,113,113,0.18); color:#fecaca; }
.status-hero-badge.wait { background: rgba(234,179,8,0.18); color:#facc15; }
.status-hero-badge.no-trade { background: rgba(148,163,184,0.18); color:#e5e7eb; }

/* piscando leve para EXECUTAR AGORA */
.blink-hero {
  animation: heroPulse 1.4s ease-in-out infinite;
}

@keyframes heroPulse {
  0%   { transform: scale(1); box-shadow: 0 0 0 0 rgba(248,113,113,0.7); }
  50%  { transform: scale(1.01); box-shadow: 0 0 0 12px rgba(248,113,113,0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(248,113,113,0); }
}

/* ====== PATTERN DRAWINGS (PADRÃO DO DIA / MOMENTO) ====== */

.pattern-canvas {
  background: rgba(15,23,42,0.9);
  border-radius: 10px;
  padding: 4px 6px;
  margin-bottom: 6px;
  border: 1px solid rgba(148,163,184,0.35);
}

.pattern-svg {
  width: 100%;
  height: 34px;
}

.prob-phrase {
  font-size: 0.76rem;
  margin-top: 4px;
  color: var(--text-soft, #9ca3af);
}

.prob-phrase.favor {
  color: #bbf7d0;
}

.prob-phrase.contra {
  color: #fecaca;
}
    /* ====== ESTRUTURA RECENTE — HH / HL / LH / LL ====== */

.structure-wrapper {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.structure-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.structure-chip {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.55);
  background: rgba(15, 23, 42, 0.95);
  font-size: 0.78rem;
}

.structure-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.16em;
  color: var(--text-soft);
}

.structure-status {
  font-weight: 500;
  color: var(--text-main);
}

.structure-dot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: #4b5563;
  box-shadow: 0 0 0 1px rgba(15, 23, 42, 1);
  margin-left: 6px;
}

.structure-dot.on {
  background: #fb7185;
  box-shadow: 0 0 10px rgba(248, 113, 113, 0.85);
}

/* ZigZag / Market Structure */

.structure-zigzag-title {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.14em;
  color: var(--text-soft);
  margin-bottom: 4px;
}

.structure-zigzag-box {
  border-radius: 10px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(15, 23, 42, 0.96);
  padding: 4px 6px;
}

.structure-zigzag-svg {
  width: 100%;
  height: 40px;
}

/* ====== GERENCIADOR DE RISCO · ATR ====== */

.risk-card {
  background: var(--card);
  border-radius: 18px;
  border: 1px solid var(--card-border);
  padding: 14px 16px;
  margin-bottom: 14px;
  box-shadow: 0 18px 40px rgba(15,23,42,0.7);
}

.risk-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.risk-title {
  font-size: 0.9rem;
  font-weight: 600;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--text-soft);
}

.risk-subtitle {
  font-size: 0.75rem;
  color: var(--text-soft);
}

.risk-toggle {
  border-radius: 999px;
  padding: 4px 12px;
  border: 1px solid var(--accent);
  background: transparent;
  color: var(--accent);
  font-size: 0.75rem;
  cursor: pointer;
}

.risk-toggle:hover {
  background: var(--accent-soft);
}

.risk-body {
  margin-top: 12px;
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 10px 12px;
}

.risk-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.risk-label {
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--text-soft);
}

.risk-group input,
.risk-group select {
  background: #020617;
  border-radius: 10px;
  border: 1px solid #1f2937;
  padding: 6px 8px;
  font-size: 0.78rem;
  color: var(--text-main);
}

.risk-group input:focus,
.risk-group select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 1px rgba(34,211,238,0.35);
}

.risk-actions {
  grid-column: 1 / -1;
  display: flex;
  justify-content: flex-start;
  margin-top: 4px;
}

.risk-actions button {
  border-radius: 999px;
  padding: 6px 16px;
  border: none;
  background: var(--accent);
  color: #020617;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
}

.risk-results {
  grid-column: 1 / -1;
  margin-top: 8px;
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 10px 12px;
}

.risk-result-label {
  font-size: 0.72rem;
  color: var(--text-soft);
}

.risk-result-value {
  font-size: 0.9rem;
  font-weight: 600;
}

.risk-result-value.small {
  font-size: 0.78rem;
  opacity: 0.8;
}

  </style>
</head>

<body>
  <div class="page">
    <!-- ====== TOPO ====== -->
    <header class="top-bar">
      <div class="top-left">
        <div class="brand-title">
          <span>AARON 9</span>&nbsp;INSTITUTIONAL PANEL
        </div>
        <div class="status-dot-live">LIVE FEED</div>
        <div class="pill-small">
          Símbolo <strong id="symbol-label">—</strong>
        </div>
        <div class="pill-small">
          Timeframe <strong id="timeframe-label">—</strong>
        </div>
        <div class="pill-small">
          Sessão <strong id="session-label">—</strong>
        </div>
      </div>

      <div class="top-right">
        <div class="pill-state" id="state-pill">AGUARDANDO</div>
        <div class="pill-soft">
          Última atualização:
          <strong id="last-update-label">—</strong>
        </div>
        <button class="btn-refresh" id="btn-refresh">ATUALIZAR</button>
      </div>
    </header>

    <div id="error-banner" class="error-banner">
      <strong>Erro ao carregar painel.</strong> Verifique o n8n / webhook e tente novamente.
    </div>

    <!-- ====== LAYOUT PRINCIPAL ====== -->
    <main class="layout">
      <!-- ====== COLUNA ESQUERDA: TV + PADRÕES ====== -->
      <section class="column">
           <!-- ====== GERENCIADOR DE RISCO · ATR ====== -->
<section class="risk-card" id="atr-risk-panel">
  <div class="risk-header">
    <div>
      <div class="risk-title">Gerenciador de risco · ATR</div>
      <div class="risk-subtitle">
        Ajuste os parâmetros do ATR e calcule risco / reward da operação.
      </div>
    </div>
    <button type="button" class="risk-toggle" id="atr-risk-toggle">Abrir</button>
  </div>

  <div class="risk-body" id="atr-risk-body" style="display:none;">
    <div class="risk-group">
      <div class="risk-label">Length</div>
      <input id="atr-length-input" type="number" value="14" min="1" />
    </div>

    <div class="risk-group">
      <div class="risk-label">Smoothing</div>
      <select id="atr-smoothing-input">
        <option value="RMA" selected>RMA</option>
        <option value="SMA">SMA</option>
        <option value="EMA">EMA</option>
        <option value="WMA">WMA</option>
      </select>
    </div>

    <div class="risk-group">
      <div class="risk-label">Multiplier</div>
      <input id="atr-multiplier-input" type="number" step="0.1" value="2.3" />
    </div>

    <div class="risk-group">
      <div class="risk-label">ATR atual</div>
      <input id="atr-value-input" type="number" step="0.01" placeholder="ex: 1.25" />
    </div>

    <div class="risk-group">
      <div class="risk-label">Capital da posição ($)</div>
      <input id="atr-capital-input" type="number" step="100" placeholder="ex: 100000" />
    </div>

    <div class="risk-group">
      <div class="risk-label">Preço de entrada</div>
      <input id="atr-entry-input" type="number" step="0.01" placeholder="ex: 177" />
    </div>

    <div class="risk-group">
      <div class="risk-label">Risco por trade (%)</div>
      <input id="atr-riskpct-input" type="number" step="0.1" value="1" />
    </div>

    <div class="risk-group">
      <div class="risk-label">Lado</div>
      <select id="atr-side-input">
        <option value="buy">Compra</option>
        <option value="sell">Venda</option>
      </select>
    </div>

    <div class="risk-actions">
      <button id="atr-calc-btn" type="button">Calcular risco</button>
    </div>

    <div class="risk-results">
      <div>
        <div class="risk-result-label">Distância do stop (ATR × mult)</div>
        <div class="risk-result-value" id="atr-stop-distance">—</div>
      </div>
      <div>
        <div class="risk-result-label">Qtd. sugerida de ações</div>
        <div class="risk-result-value" id="atr-shares">—</div>
      </div>
      <div>
        <div class="risk-result-label">Risco aproximado</div>
        <div class="risk-result-value" id="atr-risk-money">—</div>
      </div>
      <div>
        <div class="risk-result-label">Alvo 2R · 3R (aprox.)</div>
        <div class="risk-result-value" id="atr-reward-2r">—</div>
        <div class="risk-result-value small" id="atr-reward-3r">—</div>
      </div>
    </div>
  </div>
</section>
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Painel de Preço em Tempo Real</div>
              <div class="card-subtitle">TradingView + Estrutura do Dia</div>
            </div>
            <div class="badge-outline green">
              <span class="dot"></span>
              Fluxo
              <span id="flow-label">Neutro</span>
            </div>
          </div>

         

          <!-- TRADINGVIEW -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Gráfico em Tempo Real</div>
              <div class="pill-soft pill-soft-accent">
                Fonte: TradingView
              </div>
            </div>
            <div style="border-radius: 10px; overflow: hidden; border: 1px solid rgba(15,23,42,0.9); min-height: 420px;">
              <iframe
                id="tv-iframe"
                src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_fcf9d&symbol=NASDAQ%3ANVDA&interval=1&hidesidetoolbar=1&symboledit=1&saveimage=0&theme=dark&style=1&timezone=exchange"
                style="width: 100%; height: 430px; border: none;"
                loading="lazy"
                allowtransparency="true"
                scrolling="no">
              </iframe>
            </div>
          </div>
        </div>
                  <!-- ===== NOVO: Estrutura recente + Market Structure ===== -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Estrutura recente</div>
            </div>

            <div class="structure-wrapper">
              <!-- Chips HH / HL / LH / LL -->
              <div class="structure-grid">
                <div class="structure-chip" id="structure-hh">
                  <span class="structure-label">HH</span>
                  <span>
                    <span class="structure-status" id="structure-hh-status">off</span>
                    <span class="structure-dot" id="structure-hh-dot"></span>
                  </span>
                </div>

                <div class="structure-chip" id="structure-hl">
                  <span class="structure-label">HL</span>
                  <span>
                    <span class="structure-status" id="structure-hl-status">off</span>
                    <span class="structure-dot" id="structure-hl-dot"></span>
                  </span>
                </div>

                <div class="structure-chip" id="structure-lh">
                  <span class="structure-label">LH</span>
                  <span>
                    <span class="structure-status" id="structure-lh-status">ativo</span>
                    <span class="structure-dot on" id="structure-lh-dot"></span>
                  </span>
                </div>

                <div class="structure-chip" id="structure-ll">
                  <span class="structure-label">LL</span>
                  <span>
                    <span class="structure-status" id="structure-ll-status">ativo</span>
                    <span class="structure-dot on" id="structure-ll-dot"></span>
                  </span>
                </div>
              </div>

              <!-- ZigZag / Market Structure -->
              <div class="structure-zigzag">
                <div class="structure-zigzag-title">
                  Market structure · últimos candles
                </div>
                <div class="structure-zigzag-box">
                  <svg
                    id="structure-zigzag-svg"
                    class="structure-zigzag-svg"
                    viewBox="0 0 100 40"
                    preserveAspectRatio="none"
                  >
                    <polyline
                      id="structure-zigzag-poly"
                      points="0,30 15,12 30,26 45,10 60,24 75,8 90,22 100,14"
                      fill="none"
                      stroke="rgba(248,113,113,0.9)"
                      stroke-width="2.2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </div>
              </div>
            </div>
          </div>
          <!-- ===== /Estrutura recente ===== -->

      </section>

      <!-- ====== COLUNA DIREITA: RESUMO + RISCO ====== -->
      <section class="column">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Resumo Institucional</div>
              <div class="card-subtitle">Leitura consolidada do AARON 9</div>
            </div>
            <div class="badge-outline">
              <span class="dot"></span>
              Gestão de risco
            </div>
          </div>
<!-- ====== AARON 9 – COLUNA DIREITA (DECISION PANEL) ====== -->
<div class="decision-column">

  <!-- RADAR VISUAL DE DIREÇÃO -->
  <section class="decision-card">
    <div class="decision-title">Direção geral do dia</div>
    <div class="radar-header">
      <div class="radar-circle">
        <!-- seta pra baixo ou pra cima -->
        ↓
      </div>
      <div>
        <div class="decision-label-strong">Baixa forte</div>
        <div class="radar-percent">70% · baseada em tendência, volatilidade e memória A8/A9.</div>
      </div>
    </div>

    <hr style="border: none; border-top: 1px solid rgba(148,163,184,0.18); margin: 12px 0;" />

    <div class="decision-title">Direção prevista · 1–3 candles</div>
    <div class="radar-header">
      <div class="radar-circle buy">
        ↑
      </div>
      <div>
        <div class="decision-label-strong">Baixa</div>
        <div class="radar-percent">65% · fluxo geral puxa movimentos de baixa. Contexto favorece vendas.</div>
      </div>
    </div>
  </section>
<!-- HERO STATUS – MODO CEGO -->
<section id="hero-block" class="status-hero status-sell blink-hero">
  <div>
    <div class="status-hero-label">Modo cego – decisão atual</div>
    <div id="hero-main" class="status-hero-main">EXECUTAR VENDA</div>
    <div id="hero-sub" class="status-hero-sub">
      Cenário forte de venda na janela institucional. Pullback em zona, risco moderado.
    </div>
  </div>
  <div id="hero-badge" class="status-hero-badge sell">
    GO FULL
  </div>
</section>


  <!-- RESUMO INSTITUCIONAL / VEREDITO -->
  <section class="decision-card">
    <div class="decision-title">Resumo institucional</div>
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px;">
  <span id="hero-mode-pill" class="decision-pill go-full">GO FULL</span>
  <span id="hero-side-label" class="decision-label-strong">VENDA</span>
</div>


    <div id="hero-summary-text" style="font-size:0.8rem; margin-bottom:10px; color:var(--text-soft);">
  Continuação muito provável. Fluxo bem alinhado com a direção atual. Operar a favor é mais seguro que contra.
</div>


    <div style="font-size:0.78rem; margin-bottom:4px;">A favor: 78%</div>
    <div class="decision-bar">
      <div class="decision-bar-fill" style="width:78%;"></div>
    </div>

    <div style="font-size:0.78rem; margin:10px 0 4px;">Contra: 22%</div>
    <div class="decision-bar">
      <div class="decision-bar-fill-danger" style="width:22%;"></div>
    </div>
<div class="prob-phrase favor">
  Continuação muito provável; fluxo bem alinhado com a direção atual. Operar a favor é mais seguro que ir contra.
</div>

<div class="prob-phrase contra">
  Probabilidade moderada de reação contra ainda existe; evite alavancagem exagerada e respeite o stop.
</div>

    <div style="display:flex; gap:10px; margin-top:12px; font-size:0.78rem;">
      <div>
        <div class="decision-title" style="margin-bottom:2px;">Risco</div>
        <div>Moderado</div>
      </div>
      <div>
        <div class="decision-title" style="margin-bottom:2px;">Contexto</div>
        <div>Vulcão · 7:30–8:45</div>
      </div>
      <div>
        <div class="decision-title" style="margin-bottom:2px;">Execução</div>
        <div>Executar venda</div>
      </div>
    </div>
  </section>

  <!-- CHECKLIST DE PADRÕES -->
  <section class="decision-card">
    <div class="decision-title">Checklist de padrões</div>
    <div class="checklist-grid">
      <div class="check-pill on">Rompimento</div>
      <div class="check-pill">Continuação</div>
      <div class="check-pill">Reversão (ausente)</div>
      <div class="check-pill on">Divergência</div>
      <div class="check-pill">Exaustão</div>
      <div class="check-pill">Volume normal</div>
    </div>
  </section>

  <!-- PATTERN RADAR + CHECK PULLBACK -->
  <section class="decision-card">
  <div class="decision-title">Pattern radar · estrutura</div>

  <div class="pattern-layout" style="margin-top:6px;">

    <!-- PADRÃO DO DIA -->
    <div class="pattern-box">
      <div class="decision-title" style="margin-bottom:4px;">Padrão do dia</div>

      <div class="pattern-canvas">
        <!-- Desenho simbólico do padrão do dia (ex.: canal de baixa) -->
        <svg class="pattern-svg" viewBox="0 0 100 36">
          <polyline
            points="0,10 20,16 40,20 60,24 80,28 100,32"
            fill="none"
            stroke="rgba(248,113,113,0.9)"
            stroke-width="2.2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>

      <div class="pattern-name">Canal de baixa moderada</div>
      <div>
        Preço respeitando topos e fundos descendentes durante o dia. Favorece operações a favor da tendência de baixa.
      </div>
    </div>

    <!-- PADRÃO DO MOMENTO (últimos 50 candles) -->
    <div class="pattern-box">
      <div class="decision-title" style="margin-bottom:4px;">Padrão do momento · últimos 50 candles</div>

      <div class="pattern-canvas">
        <!-- Desenho simbólico do padrão do momento (ex.: range / zigue-zague) -->
        <svg class="pattern-svg" viewBox="0 0 100 36">
          <polyline
            points="0,26 15,10 30,24 45,12 60,22 75,8 90,20 100,14"
            fill="none"
            stroke="rgba(56,189,248,0.9)"
            stroke-width="2.2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>

      <div class="pattern-name">Range / consolidação ativa</div>
      <div>
        Mercado alternando entre suporte e resistência nos últimos candles. Melhor aguardar rompimento ou pullback bem claro.
      </div>
    </div>

  </div>


    <!-- Check de pullback / respiro -->
    <div class="pullback-highlight">
      <div style="font-weight:600; margin-bottom:4px;">Check de pullback</div>
      <div style="font-size:0.78rem;">
        ATR do candle atual: <strong>0.85</strong> · Profundidade: <strong>0.96 ATR</strong><br />
        Tendência: <strong>Baixa forte</strong> · Estrutura: <strong>LH</strong><br />
        Pullback dentro da faixa ideal. Continuação provável se o contexto se mantiver.
      </div>
    </div>
  </section>

</div>

          <!-- Comentário principal -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Comentário do Painel</div>
            </div>
            <div class="row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
              <div id="summary-text" style="font-size: 12px; line-height: 1.5; color: var(--text-main);">
                Aguardando primeiro alerta do TradingView para montar o painel...
              </div>
            </div>
          </div>

          <!-- Risco + Contexto -->
          <div class="grid-2">
            <div class="panel-section">
              <div class="panel-section-header">
                <div class="panel-section-title">Risco</div>
              </div>
              <div class="row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <div class="pill" id="risk-pill">Neutro</div>
                <div id="risk-text" style="font-size: 12px; color: var(--text-soft);">
                  —
                </div>
              </div>
            </div>

            <div class="panel-section">
              <div class="panel-section-header">
                <div class="panel-section-title">Contexto</div>
              </div>
              <div class="row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <div id="context-text" style="font-size: 12px; color: var(--text-soft);">
                  —
                </div>
              </div>
            </div>
          </div>

          <!-- Execução -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">Execução</div>
            </div>
            <div id="execution-text" style="font-size: 12px; color: var(--text-soft);">
              —
            </div>
          </div>
        </div>
      </section>
    </main>
      </div> <!-- /.page -->
    </div>   <!-- /.app-inner -->
  </div>     <!-- /.app-shell -->

  <script>
  // ======= CONFIG PAINEL (JSON) =======
  const PANEL_URL = 'https://jjjnogueira.app.n8n.cloud/webhook/18a1acd9-f615-4939-a6a2-5d45df087c49';
  const REFRESH_MS = 60000; // 1 minuto

  const els = {
    errorBanner: document.getElementById('error-banner'),
    btnRefresh: document.getElementById('btn-refresh'),
    state: document.getElementById('state-pill'),
    symbol: document.getElementById('symbol-label'),
    timeframe: document.getElementById('timeframe-label'),
    session: document.getElementById('session-label'),
    lastUpdate: document.getElementById('last-update-label'),
    flow: document.getElementById('flow-label'),
    trendDayPill: document.getElementById('trend-day-pill'),
    trendNowPill: document.getElementById('trend-now-pill'),
    dirDayArrow: document.getElementById('direction-day-arrow'),
    dirNowArrow: document.getElementById('direction-now-arrow'),
    patternDayLabel: document.getElementById('pattern-day-label'),
    patternDayDetail: document.getElementById('pattern-day-detail'),
    patternNowLabel: document.getElementById('pattern-now-label'),
    patternNowDetail: document.getElementById('pattern-now-detail'),
    summary: document.getElementById('summary-text'),
    riskPill: document.getElementById('risk-pill'),
    riskText: document.getElementById('risk-text'),
    contextText: document.getElementById('context-text'),
    executionText: document.getElementById('execution-text'),

    // HERO / MODO CEGO
    heroBlock: document.getElementById('hero-block'),
    heroMain: document.getElementById('hero-main'),
    heroSub: document.getElementById('hero-sub'),
    heroBadge: document.getElementById('hero-badge'),
    heroModePill: document.getElementById('hero-mode-pill'),
    heroSideLabel: document.getElementById('hero-side-label'),
    heroSummary: document.getElementById('hero-summary-text'),
  };

  // ====== GERENCIADOR DE RISCO · ATR (FRONTEND) ======
  const atrEls = {
    panel: document.getElementById('atr-risk-panel'),
    toggleBtn: document.getElementById('atr-risk-toggle'),
    body: document.getElementById('atr-risk-body'),
    length: document.getElementById('atr-length-input'),
    smoothing: document.getElementById('atr-smoothing-input'),
    mult: document.getElementById('atr-multiplier-input'),
    atrValue: document.getElementById('atr-value-input'),
    capital: document.getElementById('atr-capital-input'),
    entry: document.getElementById('atr-entry-input'),
    riskPercent: document.getElementById('atr-riskpct-input'),
    side: document.getElementById('atr-side-input'),
    outDistance: document.getElementById('atr-stop-distance'),
    outShares: document.getElementById('atr-shares'),
    outRisk: document.getElementById('atr-risk-money'),
    outReward2R: document.getElementById('atr-reward-2r'),
    outReward3R: document.getElementById('atr-reward-3r'),
    calcBtn: document.getElementById('atr-calc-btn'),
  };

  // abre / fecha o card
  if (atrEls.toggleBtn && atrEls.body) {
    atrEls.toggleBtn.addEventListener('click', () => {
      const hidden = atrEls.body.style.display === 'none' || atrEls.body.style.display === '';
      atrEls.body.style.display = hidden ? 'grid' : 'none';
      atrEls.toggleBtn.textContent = hidden ? 'Fechar' : 'Abrir';
    });
  }

  // cálculo do risco baseado no ATR digitado
  function updateAtrRisk() {
    if (!atrEls.atrValue || !atrEls.capital || !atrEls.entry) return;

    const atr = parseFloat(atrEls.atrValue.value || '0');
    const mult = parseFloat(atrEls.mult.value || '1');
    const capital = parseFloat(atrEls.capital.value || '0');
    const entry = parseFloat(atrEls.entry.value || '0');
    const riskPct = parseFloat(atrEls.riskPercent.value || '1');

    if (!atr || !capital || !entry) return;

    const stopDist = atr * mult;
    const riskPerShare = stopDist;

    const sharesByCapital = capital / entry;
    const sharesByRisk = (capital * (riskPct / 100)) / riskPerShare;
    const shares = Math.min(sharesByCapital, sharesByRisk);

    const riskMoney = shares * riskPerShare;
    const reward2R = riskMoney * 2;
    const reward3R = riskMoney * 3;

    if (atrEls.outDistance) atrEls.outDistance.textContent = stopDist.toFixed(2);
    if (atrEls.outShares) atrEls.outShares.textContent = shares.toFixed(0);
    if (atrEls.outRisk) atrEls.outRisk.textContent = '$ ' + riskMoney.toFixed(2);
    if (atrEls.outReward2R) atrEls.outReward2R.textContent = '$ ' + reward2R.toFixed(2);
    if (atrEls.outReward3R) atrEls.outReward3R.textContent = '$ ' + reward3R.toFixed(2);
  }

  if (atrEls.calcBtn) {
    atrEls.calcBtn.addEventListener('click', (e) => {
      e.preventDefault();
      updateAtrRisk();
    });
  }

  // Preenche ATR + preço de entrada a partir do JSON (panel + raw)
  function prefillAtrFromPanel(panel, raw) {
    if (!panel || !atrEls) return;

    const atrBlock = panel.atr || panel.atr_info;
    const indicators = raw && raw.indicators ? raw.indicators : {};

    // ATR
    if (atrBlock && atrBlock.value != null && atrEls.atrValue) {
      atrEls.atrValue.value = Number(atrBlock.value).toFixed(2);
    } else if (typeof indicators.atr === 'number' && atrEls.atrValue) {
      atrEls.atrValue.value = indicators.atr.toFixed(2);
    }

    if (atrBlock && atrBlock.length != null && atrEls.length) {
      atrEls.length.value = atrBlock.length;
    }
    if (atrBlock && atrBlock.smoothing && atrEls.smoothing) {
      atrEls.smoothing.value = atrBlock.smoothing;
    }
    if (atrBlock && atrBlock.multiplier != null && atrEls.mult) {
      atrEls.mult.value = atrBlock.multiplier;
    }

    // PREÇO DE ENTRADA
    let entry =
      panel.entry_price ||
      panel.reference_price ||
      panel.price_now ||
      panel.last_price ||
      (raw && raw.candle && raw.candle.close);

    if (entry != null && atrEls.entry) {
      atrEls.entry.value = Number(entry).toFixed(2);
    }
  }

  function safeText(el, value, fallback = '—') {
    if (!el) return;
    el.textContent =
      value === undefined || value === null || value === '' ? fallback : String(value);
  }

  function setArrow(el, dir) {
    if (!el) return;
    el.classList.remove('arrow-up', 'arrow-down');
    let symbol = '↕';
    if (dir === 'up' || dir === 'UP' || dir === 'alta' || dir === 'ALTA') {
      el.classList.add('arrow-up');
      symbol = '↑';
    } else if (dir === 'down' || dir === 'DOWN' || dir === 'baixa' || dir === 'BAIXA') {
      el.classList.add('arrow-down');
      symbol = '↓';
    }
    el.textContent = symbol;
  }

  function setPillTrend(el, dir, label) {
    if (!el) return;
    el.classList.remove('pill-green', 'pill-red');
    let txt = label || 'Neutro';

    if (!dir) {
      el.textContent = txt;
      return;
    }

    const d = String(dir).toLowerCase();

    if (d.includes('alta') || d === 'up') {
      el.classList.add('pill-green');
      if (!label) txt = 'Fluxo de alta';
    } else if (d.includes('baixa') || d === 'down') {
      el.classList.add('pill-red');
      if (!label) txt = 'Fluxo de baixa';
    }

    el.textContent = txt;
  }

  function setRiskPill(level) {
    if (!els.riskPill) return;
    const el = els.riskPill;
    el.classList.remove('pill-green', 'pill-red');
    let txt = 'Neutro';

    if (!level) {
      el.textContent = txt;
      return;
    }

    const l = String(level).toLowerCase();

    if (l.includes('alto') || l.includes('high')) {
      el.classList.add('pill-red');
      txt = 'Risco Alto';
    } else if (l.includes('baixo') || l.includes('low')) {
      el.classList.add('pill-green');
      txt = 'Risco Baixo';
    } else {
      txt = level;
    }

    el.textContent = txt;
  }

  function applyHeroDecision(executionText, summaryText) {
    if (!els.heroBlock) return;

    const block = els.heroBlock;
    const badge = els.heroBadge;
    const pill = els.heroModePill;
    const main = els.heroMain;
    const sub = els.heroSub;
    const side = els.heroSideLabel;
    const heroSummary = els.heroSummary;

    const baseText = executionText || 'AGUARDAR / OBSERVAR';
    const t = baseText.toLowerCase();

    let mode = 'wait';
    if (t.includes('compra') || t.includes('buy')) mode = 'buy';
    else if (t.includes('venda') || t.includes('sell')) mode = 'sell';

    block.classList.remove('status-buy', 'status-sell', 'status-wait');
    if (mode === 'buy') block.classList.add('status-buy');
    else if (mode === 'sell') block.classList.add('status-sell');
    else block.classList.add('status-wait');

    if (badge) {
      badge.textContent = mode === 'wait' ? 'WAIT' : 'GO FULL';
    }

    if (pill) {
      pill.classList.remove('go-full', 'wait', 'no-trade', 'scalp');
      if (mode === 'wait') {
        pill.classList.add('wait');
        pill.textContent = 'WAIT';
      } else {
        pill.classList.add('go-full');
        pill.textContent = 'GO FULL';
      }
    }

    if (main) main.textContent = baseText.toUpperCase();

    const fallbackSummary =
      'Aguardando leitura completa do painel para decidir.';
    const finalSummary = summaryText || fallbackSummary;

    if (sub) sub.textContent = finalSummary;
    if (heroSummary) heroSummary.textContent = finalSummary;

    if (side) {
      if (mode === 'buy') side.textContent = 'COMPRA';
      else if (mode === 'sell') side.textContent = 'VENDA';
      else side.textContent = '—';
    }
  }

  // ====== LOAD PANEL (agora usando data.panel + data.raw) ======
  async function loadPanel(showSpinner) {
    if (!PANEL_URL) return;
    try {
      if (els.errorBanner) els.errorBanner.style.display = 'none';
      if (els.btnRefresh && showSpinner) els.btnRefresh.disabled = true;

      const res = await fetch(PANEL_URL, { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);

      const data = await res.json();
      const panel = data.panel || data;   // <- AQUI: pega o objeto "panel"
      const raw = data.raw || {};         // <- AQUI: infos brutas (symbol, candle, atr...)

      // Preenche ATR + preço de entrada
      prefillAtrFromPanel(panel, raw);

      const statusGeral = panel.status_geral || {};
      const aiAdvisor = panel.ai_advisor || {};
      const patterns = panel.patterns || {};
      const patternDay = patterns.day || {};
      const patternShort = patterns.short || {};
      const meta = panel.meta || {};

      // Cabeçalho
      safeText(els.symbol, panel.symbol || raw.symbol || '—');
      safeText(els.timeframe, panel.timeframe || raw.timeframe || panel.timeframe_label || '—');
      safeText(els.session, panel.session || raw.session || panel.session_label || '—');

      const micro = panel.microcontexto || {};
      const flowLabel = panel.flow_label || panel.flow || micro.direcao;
      safeText(els.flow, flowLabel || 'Neutro');

      const stateText =
        (panel.status && (panel.status.label || panel.status.state)) ||
        statusGeral.tendencia ||
        'ONLINE';
      safeText(els.state, stateText);

      const ts = meta.panel_ts || meta.timestamp || panel.timestamp || raw.time;
      if (els.lastUpdate) {
        if (!ts) {
          els.lastUpdate.textContent = 'sem timestamp';
        } else {
          try {
            const d =
              typeof ts === 'number'
                ? new Date(ts)
                : new Date(String(ts));
            els.lastUpdate.textContent = d.toLocaleString('pt-BR', {
              timeZone: 'America/Denver',
            });
          } catch (e) {
            els.lastUpdate.textContent = String(ts);
          }
        }
      }

      // Padrões / Direções
      const patternDayName =
        panel.pattern_day ||
        panel.pattern_of_day ||
        patternDay.name;
      const patternDayDesc =
        panel.pattern_day_detail ||
        panel.pattern_of_day_detail ||
        patternDay.desc;

      const patternNowName =
        panel.pattern_now ||
        panel.pattern_of_moment ||
        patternShort.name;
      const patternNowDesc =
        panel.pattern_now_detail ||
        panel.pattern_of_moment_detail ||
        patternShort.desc;

      safeText(els.patternDayLabel, patternDayName || '-');
      safeText(els.patternDayDetail, patternDayDesc || '—');
      safeText(els.patternNowLabel, patternNowName || '-');
      safeText(els.patternNowDetail, patternNowDesc || '—');

      setArrow(els.dirDayArrow, panel.direction_day || panel.direction_of_day || micro.direcao);
      setArrow(els.dirNowArrow, panel.direction_now || panel.direction_of_moment || micro.direcao);

      setPillTrend(
        els.trendDayPill,
        panel.direction_day || panel.direction_of_day || micro.direcao,
        panel.trend_day_label
      );
      setPillTrend(
        els.trendNowPill,
        panel.direction_now || panel.direction_of_moment || micro.direcao,
        panel.trend_now_label
      );

      // Textos principais
      const finalSummary =
        panel.summary ||
        panel.painel_terminal ||
        '—';

      const riskLevel =
        panel.risk_level ||
        aiAdvisor.risco;

      const riskComment =
        panel.risk_comment ||
        aiAdvisor.motivo ||
        '—';

      const contextComment =
        panel.context_comment ||
        panel.painel_terminal ||
        '—';

      const executionPlan =
        panel.execution_plan ||
        '—';

      safeText(els.summary, finalSummary);
      setRiskPill(riskLevel);
      safeText(els.riskText, riskComment);
      safeText(els.contextText, contextComment);
      safeText(els.executionText, executionPlan);

      // MODO CEGO usa os mesmos textos
      applyHeroDecision(executionPlan, finalSummary);

    } catch (err) {
      console.error('Erro ao carregar painel', err);
      if (els.errorBanner) {
        els.errorBanner.style.display = 'block';
        els.errorBanner.innerHTML =
          '<strong>Erro ao carregar painel.</strong> Verifique o webhook "aaron9-json" no n8n e tente novamente.';
      }
    } finally {
      if (els.btnRefresh) els.btnRefresh.disabled = false;
    }
  }

  if (els.btnRefresh) {
    els.btnRefresh.addEventListener('click', function () {
      loadPanel(true);
    });
  }

  loadPanel(false);
  setInterval(loadPanel, REFRESH_MS);
</script>
</body>
</html>
