<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>AARON 9 - Painel Institucional em Tempo Real</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --bg-elevated: #020617;
      --card: #020617;
      --card-border: #1f293b;
      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.16);
      --accent-strong: #06b6d4;
      --danger: #f97373;
      --success: #4ade80;
      --warn: #fbbf24;
      --text-soft: #9ca3af;
      --text-strong: #e5e7eb;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.9);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #020617 0%, #000 55%);
      color: var(--text-strong);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    #app-shell {
      flex: 1;
      max-width: 1600px;
      margin: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* ====== TOPO (HEADER INSTITUCIONAL) ====== */

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      border-radius: var(--radius-lg);
      background: linear-gradient(120deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: var(--shadow-soft);
    }

    .brand-block {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .brand-logo {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #22d3ee, #0f172a 70%);
      box-shadow:
        0 0 18px rgba(34,211,238,0.8),
        0 0 36px rgba(34,211,238,0.45),
        0 0 60px rgba(59,130,246,0.45);
      position: relative;
      overflow: hidden;
    }

    .brand-logo::after {
      content: "9";
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 20px;
      color: #ecfeff;
      text-shadow: 0 0 12px rgba(15, 23, 42, 0.95);
    }

    .brand-text-main {
      font-size: 14px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .brand-text-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .brand-pill {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--accent);
      background: radial-gradient(circle at top, rgba(34,211,238,0.15), rgba(15,23,42,0.9));
    }

    .top-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: flex-end;
      font-size: 11px;
    }

    .chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.32);
      background: rgba(15,23,42,0.85);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-soft);
    }

    .chip-label {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 9px;
      color: #64748b;
    }

    .chip-value {
      font-size: 11px;
      color: var(--text-strong);
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 10px rgba(74,222,128,0.9);
    }

    .chip-dot.warn {
      background: var(--warn);
      box-shadow: 0 0 10px rgba(251,191,36,0.75);
    }

    .chip-dot.danger {
      background: var(--danger);
      box-shadow: 0 0 10px rgba(248,113,113,0.75);
    }

    /* ====== GRID PRINCIPAL ====== */

    .grid-main {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
      gap: 16px;
      align-items: stretch;
    }

    @media (max-width: 1100px) {
      .grid-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15,23,42,1), rgba(2,6,23,1));
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }

    .card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #64748b;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-soft);
    }

    .card-badge {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      color: var(--accent);
      background: rgba(15,23,42,0.8);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .card-body {
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: 12px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
    }

    .row-between {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .label {
      font-size: 11px;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .value-strong {
      font-size: 14px;
      font-weight: 600;
    }

    .value-soft {
      font-size: 12px;
      color: var(--text-soft);
    }

    .pill-soft {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      font-size: 11px;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill-soft span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(148,163,184,0.8);
    }

    /* ====== GAUGE / TERMÔMETROS ====== */

    .gauge-line {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle at 0% 50%, rgba(34,211,238,0.05), rgba(15,23,42,1));
      overflow: hidden;
    }

    .gauge-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #22d3ee, #0ea5e9, #f97316, #ef4444);
      transition: width 0.45s ease-out;
    }

    .gauge-scale {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 10px;
      color: #6b7280;
    }

    /* ====== BLOCO PADRÕES (Padrão do dia / momento) ====== */

    .patterns-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 800px) {
      .patterns-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .pattern-card {
      border-radius: var(--radius-md);
      border: 1px solid rgba(148,163,184,0.4);
      padding: 10px 12px;
      background:
        radial-gradient(circle at top left, rgba(34,211,238,0.06), transparent 55%),
        linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,1));
      position: relative;
      overflow: hidden;
    }

    .pattern-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
    }

    .pattern-name {
      margin-top: 4px;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pattern-tag {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      color: var(--accent-strong);
      background: rgba(15,23,42,0.9);
    }

    .pattern-notes {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .pattern-arrow {
      position: absolute;
      right: -18px;
      top: 50%;
      width: 90px;
      height: 90px;
      opacity: 0.13;
      transform: translateY(-50%) rotate(-18deg);
      border-radius: 24px;
      border: 2px solid var(--accent);
      border-left-color: transparent;
      border-bottom-color: transparent;
    }

    .pattern-arrow.down {
      transform: translateY(-50%) rotate(162deg);
      border-color: var(--danger);
      border-left-color: transparent;
      border-bottom-color: transparent;
    }

    /* ====== TABELINHAS / LISTS ====== */

    .kv-list {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 12px;
      font-size: 11px;
    }

    @media (max-width: 800px) {
      .kv-list {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .kv-item {
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .kv-key {
      color: var(--text-soft);
    }

    .kv-value {
      font-weight: 500;
    }

    /* ====== ESTADO DE ERRO / CARREGANDO ====== */

    #status-banner {
      font-size: 11px;
      color: var(--text-soft);
      text-align: right;
    }

    #status-banner span.error {
      color: var(--danger);
    }

    #status-banner span.ok {
      color: var(--success);
    }

    .muted {
      color: var(--text-soft);
      font-size: 11px;
    }
  </style>
</head>

<body>
  <div id="app-shell">
    <!-- ====== HEADER INSTITUCIONAL AARON 9 ====== -->
    <header class="top-bar">
      <div class="brand-block">
        <div class="brand-logo"></div>
        <div>
          <div class="brand-text-main">AARON 9 · AI TRADING PILOT</div>
          <div class="brand-text-title">
            Painel Institucional
            <span class="brand-pill">Price Action · Fluxo · AI</span>
          </div>
        </div>
      </div>

      <div class="top-meta">
        <div class="chip">
          <span class="chip-dot" id="chip-status-dot"></span>
          <div>
            <div class="chip-label">Ambiente</div>
            <div class="chip-value" id="chip-status-env">—</div>
          </div>
        </div>

        <div class="chip">
          <div>
            <div class="chip-label">Ativo · Tempo Gráfico</div>
            <div class="chip-value">
              <span id="chip-asset-symbol">—</span>
              ·
              <span id="chip-asset-timeframe">—</span>
            </div>
          </div>
        </div>

        <div class="chip">
          <div>
            <div class="chip-label">Última Atualização</div>
            <div class="chip-value" id="chip-updated-at">—</div>
          </div>
        </div>
      </div>
    </header>

    <div id="status-banner" class="muted">
      <span id="status-message" class="">Aguardando painel...</span>
    </div>

    <!-- ====== GRID PRINCIPAL (ESQUERDA: DIREÇÃO/AI; DIREITA: RISCO/STATUS/PADRÕES) ====== -->
    <main class="grid-main">
      <!-- COLUNA ESQUERDA -->
      <section class="card" id="card-direction-forecast">
        <div class="card-header">
          <div>
            <div class="card-title">Direção & Forecast AI</div>
            <div class="card-subtitle">Janela institucional · 7:30–9:00 MT · Próximos candles</div>
          </div>
          <span class="card-badge" id="badge-mode">MODO —</span>
        </div>

        <div class="card-body">
          <div class="row-between">
            <div>
              <div class="label">Viés principal</div>
              <div class="value-strong" id="direction-bias">—</div>
              <div class="value-soft" id="direction-context">—</div>
            </div>
            <div>
              <div class="label">Confiança AI</div>
              <div class="value-strong" id="direction-confidence">—</div>
              <div class="value-soft" id="direction-window">—</div>
            </div>
          </div>

          <!-- ====== GAUGE DIRECIONAL (TERMÔMETRO A FAVOR / CONTRA) ====== -->
          <div>
            <div class="row-between">
              <div class="label">Fluxo & Confirmação</div>
              <div class="pill-soft">
                <span class="dot"></span>
                <span id="flowsync-label">FlowSync —</span>
              </div>
            </div>
            <div class="gauge-line">
              <div class="gauge-fill" id="gauge-direction"></div>
            </div>
            <div class="gauge-scale">
              <span>A favor</span>
              <span>Neutro</span>
              <span>Contra</span>
            </div>
          </div>

          <!-- FORECAST -->
          <div class="row-between">
            <div>
              <div class="label">Próximo movimento</div>
              <div class="value-strong" id="forecast-next-move">—</div>
              <div class="value-soft" id="forecast-notes">—</div>
            </div>
            <div>
              <div class="label">Alvo & Probabilidade</div>
              <div class="value-strong" id="forecast-target">—</div>
              <div class="value-soft" id="forecast-probability">—</div>
            </div>
          </div>
        </div>
      </section>

      <!-- COLUNA DIREITA -->
      <section style="display: flex; flex-direction: column; gap: 16px;">
        <!-- BLOCO STATUS & PREÇO -->
        <div class="card" id="card-asset-status">
          <div class="card-header">
            <div>
              <div class="card-title">Status do Ativo</div>
              <div class="card-subtitle">Preço, variação e sessão atual</div>
            </div>
          </div>
          <div class="card-body">
            <div class="row-between">
              <div>
                <div class="label">Ativo</div>
                <div class="value-strong" id="asset-symbol-main">—</div>
                <div class="value-soft" id="asset-session">—</div>
              </div>
              <div style="text-align: right;">
                <div class="label">Último preço</div>
                <div class="value-strong" id="asset-last-price">—</div>
                <div class="value-soft">
                  <span id="asset-change">—</span>
                  ·
                  <span id="asset-range">H: — · L: —</span>
                </div>
              </div>
            </div>

            <div class="kv-list">
              <div class="kv-item">
                <span class="kv-key">Volume</span>
                <span class="kv-value" id="asset-volume">—</span>
              </div>
              <div class="kv-item">
                <span class="kv-key">Volatilidade (ATR)</span>
                <span class="kv-value" id="asset-atr">—</span>
              </div>
              <div class="kv-item">
                <span class="kv-key">Janela institucional</span>
                <span class="kv-value" id="asset-window">7:30–9:00 MT</span>
              </div>
              <div class="kv-item">
                <span class="kv-key">Fonte</span>
                <span class="kv-value" id="asset-source">TradingView · AARON 9</span>
              </div>
            </div>
          </div>
        </div>

        <!-- BLOCO RISCO & EXECUÇÃO -->
        <div class="card" id="card-risk">
          <div class="card-header">
            <div>
              <div class="card-title">Risco & Execução</div>
              <div class="card-subtitle">Perfil, tamanho de posição e modo de saída</div>
            </div>
          </div>
          <div class="card-body">
            <div class="row-between">
              <div>
                <div class="label">Perfil de risco</div>
                <div class="value-strong" id="risk-profile">—</div>
                <div class="value-soft" id="risk-notes">—</div>
              </div>
              <div style="text-align: right;">
                <div class="label">Modo de saída</div>
                <div class="value-strong" id="risk-exit-mode">—</div>
                <div class="value-soft" id="risk-rr">R:R —</div>
              </div>
            </div>

            <div class="kv-list">
              <div class="kv-item">
                <span class="kv-key">Tamanho sugerido</span>
                <span class="kv-value" id="risk-position-size">—</span>
              </div>
              <div class="kv-item">
                <span class="kv-key">Capital em risco</span>
                <span class="kv-value" id="risk-capital">—</span>
              </div>
              <div class="kv-item">
                <span class="kv-key">Stop técnico</span>
                <span class="kv-value" id="risk-stop">—</span>
              </div>
              <div class="kv-item">
                <span class="kv-key">Tipo de ordem</span>
                <span class="kv-value" id="risk-order-type">—</span>
              </div>
            </div>
          </div>
        </div>

        <!-- BLOCO PADRÕES DO DIA & MOMENTO -->
        <div class="card" id="card-patterns">
          <div class="card-header">
            <div>
              <div class="card-title">Padrões de Price Action</div>
              <div class="card-subtitle">Padrão institucional do dia & padrão do momento</div>
            </div>
          </div>
          <div class="card-body">
            <div class="patterns-grid">
              <!-- Padrão do dia -->
              <div class="pattern-card" id="pattern-day-card">
                <div class="pattern-label">// Padrão institucional do dia</div>
                <div class="pattern-name">
                  <span id="pattern-day-name">—</span>
                  <span class="pattern-tag" id="pattern-day-tag">—</span>
                </div>
                <div class="pattern-notes" id="pattern-day-notes">—</div>
                <div class="pattern-arrow" id="pattern-day-arrow"></div>
              </div>

              <!-- Padrão do momento -->
              <div class="pattern-card" id="pattern-now-card">
                <div class="pattern-label">// Padrão do momento</div>
                <div class="pattern-name">
                  <span id="pattern-now-name">—</span>
                  <span class="pattern-tag" id="pattern-now-tag">—</span>
                </div>
                <div class="pattern-notes" id="pattern-now-notes">—</div>
                <div class="pattern-arrow" id="pattern-now-arrow"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ======= CONFIG PAINEL (JSON) =======
    // Substitua pelo SEU webhook do n8n que retorna { "panel": { ... } }
    const PANEL_URL = 'https://jjjnogueira.app.n8n.cloud/webhook/aaron9-json';
    const REFRESH_MS = 60000; // 60s

    function safeNum(v, dec = 2) {
      const n = Number(v);
      if (isNaN(n)) return v ?? '—';
      return n.toFixed(dec);
    }

    function fmtChange(v) {
      if (v === undefined || v === null) return '—';
      const n = Number(v);
      if (isNaN(n)) return v;
      const sign = n > 0 ? '+' : '';
      return sign + n.toFixed(2) + '%';
    }

    function fmtMoney(v, dec = 2) {
      const n = Number(v);
      if (isNaN(n)) return v ?? '—';
      return '$' + n.toFixed(dec);
    }

    function fmtVolume(v) {
      const n = Number(v);
      if (isNaN(n)) return v ?? '—';
      if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
      if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
      if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
      return String(n);
    }

    function fmtTimestamp(ts) {
      if (ts === undefined || ts === null) return '—';
      if (typeof ts === 'string' && !isNaN(Number(ts))) ts = Number(ts);
      if (typeof ts === 'number') {
        try {
          return new Date(ts).toLocaleString('en-US', {
            timeZone: 'America/Denver'
          });
        } catch (e) {
          return String(ts);
        }
      }
      return String(ts);
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value ?? '—';
    }

    function setGaugePercent(id, percent) {
      const el = document.getElementById(id);
      if (!el) return;
      const n = Number(percent);
      if (isNaN(n)) {
        el.style.width = '0%';
        return;
      }
      const clamped = Math.min(100, Math.max(0, n));
      el.style.width = clamped + '%';
    }

    function setPattern(direction, arrowId) {
      const arrow = document.getElementById(arrowId);
      if (!arrow) return;
      arrow.classList.remove('down');
      const dir = (direction || '').toString().toLowerCase();
      if (dir.includes('down') || dir.includes('sell') || dir.includes('bear') || dir.includes('queda')) {
        arrow.classList.add('down');
      }
    }

    function setConnectionStatus(ok, msg) {
      const statusSpan = document.getElementById('status-message');
      const dot = document.getElementById('chip-status-dot');
      if (!statusSpan || !dot) return;

      statusSpan.textContent = msg;
      statusSpan.classList.remove('ok', 'error');

      dot.classList.remove('warn', 'danger');

      if (ok) {
        statusSpan.classList.add('ok');
      } else {
        statusSpan.classList.add('error');
        dot.classList.add('danger');
      }
    }

    function applyPanel(raw) {
      const panel = raw && raw.panel ? raw.panel : raw || {};

      const status = panel.status || {};
      const meta = panel.meta || {};
      const asset = panel.asset || {};
      const risk = panel.risk || {};
      const forecast = panel.forecast || {};
      const flow = panel.flow || panel.flowsync || {};
      const patterns = panel.patterns || {};

      // Header chips
      setText('chip-status-env', status.env || status.environment || 'Live');
      setText('chip-asset-symbol', asset.symbol || asset.ticker || '—');
      setText('chip-asset-timeframe', asset.timeframe || asset.tf || '—');
      setText('chip-updated-at', meta.updated_at_human || fmtTimestamp(meta.timestamp || panel.timestamp));

      // Modo / badge
      setText('badge-mode', (status.mode_label || status.mode || 'MODO —').toString().toUpperCase());

      // Direção / forecast
      setText('direction-bias', forecast.bias || forecast.direction || '—');
      setText('direction-context', forecast.context || forecast.comment || '—');

      const conf = forecast.confidence != null ? forecast.confidence : forecast.conf_pct;
      setText('direction-confidence', conf != null ? safeNum(conf, 0) + '%' : '—');

      setText('direction-window', forecast.window || 'Próximos 1–3 candles');
      setText('flowsync-label', flow.label || ('FlowSync ' + (flow.score != null ? safeNum(flow.score, 0) + '%' : '—')));
      setGaugePercent('gauge-direction', flow.score != null ? flow.score : flow.percent);

      setText('forecast-next-move', forecast.next_move || forecast.move || '—');
      setText('forecast-notes', forecast.notes || forecast.description || '—');

      const targetPrice = forecast.target_price != null ? fmtMoney(forecast.target_price) : (forecast.target || '—');
      const prob = forecast.probability != null ? safeNum(forecast.probability, 0) + '%' : (forecast.prob || '—');
      setText('forecast-target', targetPrice);
      setText('forecast-probability', prob);

      // Ativo / preço
      const symbol = asset.symbol || asset.ticker || '—';
      setText('asset-symbol-main', symbol);
      setText('asset-session', asset.session || asset.market_session || '—');

      const last = asset.last != null ? fmtMoney(asset.last) : (asset.last_price != null ? fmtMoney(asset.last_price) : '—');
      setText('asset-last-price', last);

      const chg = asset.change_pct != null ? fmtChange(asset.change_pct) : (asset.change != null ? fmtChange(asset.change) : '—');
      setText('asset-change', chg);

      const hi = asset.high != null ? fmtMoney(asset.high) : '—';
      const lo = asset.low != null ? fmtMoney(asset.low) : '—';
      setText('asset-range', `H: ${hi} · L: ${lo}`);

      setText('asset-volume', fmtVolume(asset.volume));
      setText('asset-atr', asset.atr != null ? safeNum(asset.atr, 2) : '—');
      setText('asset-window', asset.window || '7:30–9:00 MT');
      setText('asset-source', asset.source || 'TradingView · AARON 9');

      // Risco
      setText('risk-profile', risk.profile || risk.mode || '—');
      setText('risk-notes', risk.notes || risk.comment || '—');
      setText('risk-exit-mode', risk.exit_mode || risk.exit || '—');

      const rr = risk.rr || risk.risk_reward || null;
      setText('risk-rr', rr ? ('R:R ' + rr) : 'R:R —');

      const pos = risk.size_shares != null ? risk.size_shares + ' shares' :
                  risk.size != null ? risk.size : '—';
      setText('risk-position-size', pos);

      const cap = risk.capital_risked != null ? fmtMoney(risk.capital_risked) : (risk.capital || '—');
      setText('risk-capital', cap);

      setText('risk-stop', risk.stop || risk.stop_desc || '—');
      setText('risk-order-type', risk.order_type || risk.entry_type || '—');

      // Padrões
      const day = patterns.day || patterns.pattern_day || {};
      const now = patterns.moment || patterns.now || patterns.current || {};

      setText('pattern-day-name', day.name || '—');
      setText('pattern-day-tag', day.tag || day.category || 'Institucional');
      setText('pattern-day-notes', day.notes || day.description || '—');
      setPattern(day.direction || day.bias, 'pattern-day-arrow');

      setText('pattern-now-name', now.name || '—');
      setText('pattern-now-tag', now.tag || now.category || 'Intraday');
      setText('pattern-now-notes', now.notes || now.description || '—');
      setPattern(now.direction || now.bias, 'pattern-now-arrow');
    }

    async function loadPanel() {
      try {
        const res = await fetch(PANEL_URL, {
          method: 'GET',
          headers: {
            'Accept': 'application/json'
          },
          cache: 'no-store'
        });

        if (!res.ok) {
          setConnectionStatus(false, 'Erro ao buscar painel (' + res.status + '). Tentando novamente…');
          return;
        }

        const data = await res.json();
        applyPanel(data);
        setConnectionStatus(true, 'Conectado · painel atualizado');
      } catch (err) {
        console.error('Erro ao buscar painel:', err);
        setConnectionStatus(false, 'Conexão perdida · tentando novamente em alguns segundos…');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadPanel();
      setInterval(loadPanel, REFRESH_MS);
    });
  </script>
</body>
</html>