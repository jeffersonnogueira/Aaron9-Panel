<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>AARON 9 - Painel em Tempo Real</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --card-border: #1f293b;
      --accent: #22d3ee;
      --accent-soft: rgba(34, 211, 238, 0.12);
      --danger: #f97373;
      --success: #4ade80;
      --text-soft: #9ca3af;
      --text-main: #e5e7eb;
      --shadow-strong: 0 24px 60px rgba(15, 23, 42, 0.95);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app-shell {
      flex: 1;
      max-width: 1680px;
      margin: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* TOP BAR */
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 18px;
      border-radius: var(--radius-lg);
      border: 1px solid #1f2937;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.7));
      box-shadow: 0 22px 50px rgba(0, 0, 0, 0.85);
    }

    .brand-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-title {
      font-size: 18px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .brand-main {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .status-pill {
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(34, 211, 238, 0.07);
      border: 1px solid rgba(34, 211, 238, 0.4);
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 10px rgba(74, 222, 128, 0.8);
    }

    .timestamp {
      font-size: 12px;
      color: var(--text-soft);
    }

    /* LAYOUT 2 COLUNAS */
    .layout {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
      gap: 12px;
      align-items: stretch;
    }

    .card {
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.85), #020617 55%, #020617 100%);
      box-shadow: var(--shadow-strong);
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(34, 211, 238, 0.12), transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: 100%;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .card-title {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: #9ca3af;
    }

    .badge {
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
    }

    /* ESQUERDA: TRADINGVIEW */
    .chart-wrapper {
      flex: 1;
      border-radius: 14px;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at bottom, rgba(15, 23, 42, 0.7), rgba(15, 23, 42, 0.3));
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #tradingview_container {
      flex: 1;
      min-height: 360px;
    }

    .chart-placeholder-text {
      font-size: 13px;
      color: var(--text-soft);
      text-align: center;
      padding: 8px;
    }

    /* DIREITA: PAINEL COMPLETO AARON 9 */
    #panel-root {
      overflow-y: auto;
      padding-right: 6px;
    }

    .panel-section {
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.92);
      padding: 10px 12px;
      margin-bottom: 8px;
    }

    .panel-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .panel-section-title {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .pill {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 10px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .pill-green {
      border-color: rgba(74, 222, 128, 0.8);
      color: var(--success);
    }

    .pill-red {
      border-color: rgba(248, 113, 113, 0.8);
      color: var(--danger);
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 11px;
      margin-bottom: 2px;
    }

    .label-soft {
      color: var(--text-soft);
      font-size: 11px;
    }

    .value-main {
      font-size: 13px;
      font-weight: 600;
    }

    .value-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .meter {
      position: relative;
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      overflow: hidden;
      border: 1px solid rgba(31, 41, 55, 0.9);
      margin-top: 4px;
    }

    .meter-fill {
      position: absolute;
      inset: 0;
      transform-origin: left center;
      transform: scaleX(0.5);
      background: linear-gradient(90deg, #22d3ee, #4ade80);
    }

    .meter-fill-red {
      background: linear-gradient(90deg, #f97373, #fb923c);
    }

    textarea.console-text {
      width: 100%;
      min-height: 210px;
      border-radius: 10px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.9));
      color: var(--text-main);
      font-size: 11px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      resize: none;
      padding: 8px 9px;
      line-height: 1.4;
    }

    .two-cols {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.1fr);
      gap: 8px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .small-grid-4 {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 4px;
      margin-top: 4px;
    }

    .small-cell {
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 3px 6px;
      font-size: 10px;
      text-align: center;
      background: rgba(15, 23, 42, 0.95);
    }

    .checklist-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 4px;
      margin-top: 4px;
    }

    .check-item {
      font-size: 11px;
      border-radius: 8px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 4px 6px;
      background: rgba(15, 23, 42, 0.95);
    }

    .pattern-box {
      border-radius: 10px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      padding: 6px 8px;
      font-size: 11px;
      margin-top: 4px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95));
    }

    .mini-chart {
      height: 60px;
      border-radius: 8px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at center, rgba(15, 23, 42, 0.7), rgba(15, 23, 42, 0.95));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .conclusion-block {
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95));
      padding: 9px 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
      margin-top: 6px;
    }

    .conclusion-title {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .panel-footer {
      margin-top: 4px;
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      opacity: 0.85;
    }

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- TOPO -->
    <header class="top-bar">
      <div class="brand-block">
        <div class="brand-title">THE SIXSEATS INVESTMENTS</div>
        <div class="brand-main">AARON 9 – AI ULTRA</div>
      </div>
      <div style="display:flex; flex-direction:column; gap:4px; align-items:flex-end;">
        <div class="status-pill">
          <span class="status-dot"></span>
          <span id="status-text">Erro ao buscar painel (404)</span>
        </div>
        <span class="timestamp" id="header-timestamp">Sem dados ainda</span>
      </div>
    </header>

    <!-- LAYOUT 2 COLUNAS -->
    <main class="layout">
      <!-- ESQUERDA: TRADINGVIEW -->
      <section class="card">
        <div class="card-inner">
          <div class="card-header">
            <div class="card-title">JANELA DO GRÁFICO</div>
            <span class="badge">TradingView aqui depois</span>
          </div>
          <div class="chart-wrapper">
            <div id="tradingview_container"></div>
            <div class="chart-placeholder-text">
              Se nada aparecer, verifique se o Brave / ad-block não está bloqueando o script do TradingView.
            </div>
          </div>
        </div>
      </section>

      <!-- DIREITA: PAINEL COMPLETO -->
      <section class="card">
        <div class="card-inner" id="panel-root">
          <div class="card-header">
            <div class="card-title">PAINEL AARON 9</div>
            <span class="badge" id="symbol-badge">Sem ativo</span>
          </div>

          <!-- CONSOLE INTELIGENTE – RESUMO COMPLETO -->
          <div class="panel-section">
            <div class="panel-section-header">
              <div class="panel-section-title">CONSOLE INTELIGENTE – RESUMO COMPLETO</div>
              <span class="pill" id="state-pill">Estado: aguardando dados</span>
            </div>
            <div class="row">
              <span class="label-soft">Estado atual:</span>
              <span class="value-main" id="state-title">—</span>
            </div>
            <div class="row">
              <span class="label-soft">Tendência / Vies:</span>
              <span id="bias-text" class="pill">—</span>
            </div>
            <div class="row">
              <span class="label-soft">Probabilidade do cenário:</span>
              <span id="scenario-prob" class="pill pill-green">—</span>
            </div>
            <div class="meter">
              <div class="meter-fill" id="scenario-meter"></div>
            </div>
            <textarea id="console-text" class="console-text" readonly>
Aguardando primeiro alerta do TradingView para montar o resumo completo do dia...
            </textarea>
          </div>

          <!-- LAYOUT INTERNO 2 COLUNAS (ESQUERDA E DIREITA) -->
          <div class="two-cols">
            <!-- COLUNA ESQUERDA INTERNA -->
            <div>
              <!-- MARKET STRUCTURE / HH HL -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">ESTRUTURA RECENTE</div>
                  <span class="pill" id="structure-trend-pill">—</span>
                </div>
                <div class="small-grid-4">
                  <div class="small-cell">HH: <span id="hh-val">—</span></div>
                  <div class="small-cell">HL: <span id="hl-val">—</span></div>
                  <div class="small-cell">LH: <span id="lh-val">—</span></div>
                  <div class="small-cell">LL: <span id="ll-val">—</span></div>
                </div>
                <div class="value-sub" id="structure-comment" style="margin-top:4px;">
                  AARON lê o zigzag / estrutura para entender se é continuação ou reversão.
                </div>
              </div>

              <!-- PADRÕES PROVÁVEIS – INTRADAY -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">PADRÃO PROVÁVEL (INTRADAY)</div>
                  <span class="pill" id="pattern-day-label">—</span>
                </div>
                <div class="pattern-box">
                  <div class="value-main" id="pattern-day-name">—</div>
                  <div class="value-sub" id="pattern-day-desc">
                    Aguardando leitura do padrão predominante do dia.
                  </div>
                  <div class="mini-chart" id="pattern-day-chart">
                    Desenho / padrão do dia (exemplo visual).
                  </div>
                </div>
              </div>

              <!-- PADRÕES PROVÁVEIS – CURTO PRAZO -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">PADRÃO PROVÁVEL (CURTO PRAZO)</div>
                  <span class="pill" id="pattern-short-label">—</span>
                </div>
                <div class="pattern-box">
                  <div class="value-main" id="pattern-short-name">—</div>
                  <div class="value-sub" id="pattern-short-desc">
                    Padrão dos próximos candles (1–3) segundo o AARON.
                  </div>
                  <div class="mini-chart" id="pattern-short-chart">
                    Mini-gráfico de curto prazo.
                  </div>
                </div>
              </div>
            </div>

            <!-- COLUNA DIREITA INTERNA -->
            <div>
              <!-- RADAR VISUAL DE DIREÇÃO (DIA) -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">RADAR VISUAL – DIREÇÃO DO DIA</div>
                  <span class="pill" id="radar-day-strength-pill">—</span>
                </div>
                <div class="value-main" id="radar-day-title">—</div>
                <div class="value-sub" id="radar-day-desc">
                  AARON ainda não leu a direção predominante do dia.
                </div>
                <div class="row" style="margin-top:4px;">
                  <span class="label-soft">Confiança no cenário geral:</span>
                  <span class="pill pill-green" id="radar-day-conf-pill">—</span>
                </div>
                <div class="meter">
                  <div class="meter-fill" id="radar-day-meter"></div>
                </div>
              </div>

              <!-- DIREÇÃO PREVISTA (CURTO PRAZO – 1–3 CANDLES) -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">DIREÇÃO PREVISTA (CURTO PRAZO – 1–3 CANDLES)</div>
                  <span class="pill" id="forecast-short-pill">—</span>
                </div>
                <div class="value-main" id="forecast-short-title">—</div>
                <div class="value-sub" id="forecast-short-desc">
                  AARON monta a previsão dos próximos candles a partir do fluxo atual.
                </div>
                <div class="row" style="margin-top:4px;">
                  <span class="label-soft">Confiança na direção:</span>
                  <span class="pill pill-green" id="forecast-short-conf-pill">—</span>
                </div>
                <div class="meter">
                  <div class="meter-fill" id="forecast-short-meter"></div>
                </div>
              </div>

              <!-- COMANDO FINAL / EXECUÇÃO -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">COMANDO FINAL / EXECUÇÃO</div>
                  <span class="pill" id="execution-mode-pill">Aguardando / observar</span>
                </div>
                <div class="value-main" id="execution-label">—</div>
                <div class="value-sub" id="execution-desc">
                  Quando todos os blocos se alinham, aqui aparece o comando final do AARON.
                </div>

                <div class="row" style="margin-top:6px;">
                  <span class="label-soft">Fluxo a favor:</span>
                  <span class="pill pill-green" id="flow-favor-pill">—</span>
                </div>
                <div class="meter">
                  <div class="meter-fill" id="flow-favor-meter"></div>
                </div>

                <div class="row" style="margin-top:4px;">
                  <span class="label-soft">Fluxo contra:</span>
                  <span class="pill pill-red" id="flow-against-pill">—</span>
                </div>
                <div class="meter">
                  <div class="meter-fill meter-fill-red" id="flow-against-meter"></div>
                </div>
              </div>

              <!-- CHECKLIST DO AARON -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">CHECKLIST DO AARON</div>
                  <span class="pill" id="checklist-score-pill">—</span>
                </div>
                <div class="checklist-grid" id="checklist-grid">
                  <div class="check-item">Movimento: <span id="check-move">—</span></div>
                  <div class="check-item">Continuação: <span id="check-cont">—</span></div>
                  <div class="check-item">Reversão: <span id="check-rev">—</span></div>
                  <div class="check-item">Exaustão: <span id="check-exh">—</span></div>
                  <div class="check-item">Divergência: <span id="check-div">—</span></div>
                  <div class="check-item">Volume: <span id="check-vol">—</span></div>
                </div>
                <div class="value-sub" style="margin-top:4px;" id="checklist-comment">
                  Checklist rápido para evitar “gambling” e focar em setups com edge.
                </div>
              </div>

              <!-- CHECK DE PULLBACK / RESPIRO -->
              <div class="panel-section">
                <div class="panel-section-header">
                  <div class="panel-section-title">CHECK DE PULLBACK / RESPIRO</div>
                  <span class="pill" id="pullback-status-pill">—</span>
                </div>
                <div class="row">
                  <span class="label-soft">ATR do candle atual:</span>
                  <span class="value-main" id="pullback-atr">—</span>
                </div>
                <div class="row">
                  <span class="label-soft">Tendência:</span>
                  <span id="pullback-trend" class="pill">—</span>
                </div>
                <div class="row">
                  <span class="label-soft">Estrutura:</span>
                  <span id="pullback-structure" class="pill">—</span>
                </div>
                <div class="row">
                  <span class="label-soft">Pullback:</span>
                  <span id="pullback-multiple" class="pill">—</span>
                </div>
                <div class="value-sub" id="pullback-comment" style="margin-top:4px;">
                  Conclusão do AARON sobre se é só respiro ou risco de reversão.
                </div>
              </div>
            </div>
          </div>

          <!-- CONCLUSÃO FINAL -->
          <div class="conclusion-block">
            <div class="conclusion-title">CONCLUSÃO DO AARON</div>
            <div class="value-main" id="conclusion-text">
              Aguardando primeiro alerta do TradingView para montar o cenário.
            </div>
          </div>

          <!-- FOOTER -->
          <div class="panel-footer">
            <span id="panel-symbol-tf">Ativo / Tempo gráfico: —</span>
            <span id="panel-timestamp">Sem timestamp</span>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- SCRIPT DO TRADINGVIEW -->
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

  <script>
    // ======= CONFIG PAINEL (JSON) =======
    // Busca sempre "panel.json" na raiz do projeto Vercel.
    const PANEL_URL = 'https://jjjnogueira.app.n8n.cloud/webhook/18a1acd9-f615-4939-a6a2-5d45df087c49';
    const REFRESH_MS = 60000; // 60.000 ms = 1 minuto

    function clamp01(x) {
      if (typeof x !== 'number' || isNaN(x)) return 0;
      return Math.min(1, Math.max(0, x));
    }

    function setMeter(el, pct) {
      if (!el) return;
      const v = clamp01(pct);
      el.style.transform = 'scaleX(' + v + ')';
    }

    function fmtTsUtah(ts) {
      if (ts === undefined || ts === null) return 'sem timestamp';
      if (typeof ts === 'string') {
        const n = Number(ts);
        if (!isNaN(n)) ts = n;
      }
      if (typeof ts === 'number') {
        try {
          return new Date(ts).toLocaleString('en-US', {
            timeZone: 'America/Denver'
          });
        } catch (e) {
          return String(ts);
        }
      }
      return String(ts);
    }

    function pctText(v) {
      if (typeof v !== 'number') return '—';
      return v.toFixed(0) + '%';
    }

    // ======= RENDERIZAÇÃO DO PAINEL =======
    function renderPanel(panel) {
      if (!panel || typeof panel !== 'object') return;

      const meta       = panel.meta       || {};
      const status     = panel.status     || {};
      const summary    = panel.summary    || {};
      const structure  = panel.structure  || {};
      const radar      = panel.radar      || {};
      const forecast   = panel.forecast   || {};
      const flow       = panel.flow       || {};
      const checklist  = panel.checklist  || {};
      const pullback   = panel.pullback   || {};
      const patterns   = panel.patterns   || {};
      const consoleObj = panel.console    || {};
      const execution  = panel.execution  || {};

      // topo
      document.getElementById('status-text').textContent =
        status.label || 'Painel ativo';

      document.getElementById('header-timestamp').textContent =
        meta.serverNow || 'Atualizado';

      const symbolStr = (status.symbol || '—') + ' · ' + (status.timeframe || '—');
      document.getElementById('symbol-badge').textContent = symbolStr;
      document.getElementById('panel-symbol-tf').textContent =
        'Ativo / Tempo gráfico: ' + symbolStr;

      document.getElementById('panel-timestamp').textContent =
        'Painel: ' + fmtTsUtah(panel.timestamp);

      // Console / resumo
      document.getElementById('state-pill').textContent =
        summary.stateLabel || 'Estado do dia';
      document.getElementById('state-title').textContent =
        summary.stateTitle || '—';
      document.getElementById('bias-text').textContent =
        summary.bias || '—';
      document.getElementById('scenario-prob').textContent =
        pctText(summary.prob);
      setMeter(document.getElementById('scenario-meter'),
        typeof summary.prob === 'number' ? summary.prob / 100 : 0);
      document.getElementById('console-text').value =
        consoleObj.text || 'Sem resumo detalhado ainda.';

      // Estrutura recente (HH HL LH LL)
      document.getElementById('structure-trend-pill').textContent =
        structure.trendLabel || '—';
      document.getElementById('hh-val').textContent = structure.hh ?? '—';
      document.getElementById('hl-val').textContent = structure.hl ?? '—';
      document.getElementById('lh-val').textContent = structure.lh ?? '—';
      document.getElementById('ll-val').textContent = structure.ll ?? '—';
      document.getElementById('structure-comment').textContent =
        structure.comment || document.getElementById('structure-comment').textContent;

      // Padrão intraday
      const pDay = patterns.day || {};
      document.getElementById('pattern-day-label').textContent =
        pDay.label || '—';
      document.getElementById('pattern-day-name').textContent =
        pDay.name || '—';
      document.getElementById('pattern-day-desc').textContent =
        pDay.desc || document.getElementById('pattern-day-desc').textContent;

      // Padrão curto prazo
      const pShort = patterns.short || {};
      document.getElementById('pattern-short-label').textContent =
        pShort.label || '—';
      document.getElementById('pattern-short-name').textContent =
        pShort.name || '—';
      document.getElementById('pattern-short-desc').textContent =
        pShort.desc || document.getElementById('pattern-short-desc').textContent;

      // Radar do dia
      document.getElementById('radar-day-strength-pill').textContent =
        radar.strength || '—';
      document.getElementById('radar-day-title').textContent =
        radar.title || '—';
      document.getElementById('radar-day-desc').textContent =
        radar.desc || document.getElementById('radar-day-desc').textContent;
      document.getElementById('radar-day-conf-pill').textContent =
        pctText(radar.conf);
      setMeter(document.getElementById('radar-day-meter'),
        typeof radar.conf === 'number' ? radar.conf / 100 : 0);

      // Forecast curto prazo
      const fShort = forecast.short || {};
      document.getElementById('forecast-short-pill').textContent =
        fShort.label || '—';
      document.getElementById('forecast-short-title').textContent =
        fShort.title || '—';
      document.getElementById('forecast-short-desc').textContent =
        fShort.desc || document.getElementById('forecast-short-desc').textContent;
      document.getElementById('forecast-short-conf-pill').textContent =
        pctText(fShort.conf);
      setMeter(document.getElementById('forecast-short-meter'),
        typeof fShort.conf === 'number' ? fShort.conf / 100 : 0);

      // Flow / comando final
      document.getElementById('execution-mode-pill').textContent =
        execution.mode || 'Aguardando / observar';
      document.getElementById('execution-label').textContent =
        execution.label || '—';
      document.getElementById('execution-desc').textContent =
        execution.desc || document.getElementById('execution-desc').textContent;

      document.getElementById('flow-favor-pill').textContent =
        pctText(flow.favorPct);
      setMeter(document.getElementById('flow-favor-meter'),
        typeof flow.favorPct === 'number' ? flow.favorPct / 100 : 0);
      document.getElementById('flow-against-pill').textContent =
        pctText(flow.againstPct);
      setMeter(document.getElementById('flow-against-meter'),
        typeof flow.againstPct === 'number' ? flow.againstPct / 100 : 0);

      // Checklist do AARON
      document.getElementById('check-move').textContent =
        checklist.move ?? '—';
      document.getElementById('check-cont').textContent =
        checklist.cont ?? '—';
      document.getElementById('check-rev').textContent =
        checklist.rev ?? '—';
      document.getElementById('check-exh').textContent =
        checklist.exh ?? '—';
      document.getElementById('check-div').textContent =
        checklist.div ?? '—';
      document.getElementById('check-vol').textContent =
        checklist.vol ?? '—';

      document.getElementById('checklist-score-pill').textContent =
        checklist.scoreLabel || 'Score: —';

      document.getElementById('checklist-comment').textContent =
        checklist.comment || document.getElementById('checklist-comment').textContent;

      // Pullback / Respiro
      document.getElementById('pullback-status-pill').textContent =
        pullback.statusLabel || '—';

      document.getElementById('pullback-atr').textContent =
        (typeof pullback.atr === 'number')
          ? pullback.atr.toFixed(2)
          : (pullback.atr ?? '—');

      document.getElementById('pullback-trend').textContent =
        pullback.trend || '—';

      document.getElementById('pullback-structure').textContent =
        pullback.structure || '—';

      document.getElementById('pullback-multiple').textContent =
        pullback.multipleLabel || (typeof pullback.multiple === 'number'
          ? pullback.multiple.toFixed(2) + ' × ATR'
          : (pullback.multiple ?? '—'));

      document.getElementById('pullback-comment').textContent =
        pullback.comment || document.getElementById('pullback-comment').textContent;

      // Conclusão final
      document.getElementById('conclusion-text').textContent =
        (panel.conclusion && panel.conclusion.text) ||
        summary.conclusion ||
        document.getElementById('conclusion-text').textContent;

      // Atualiza TradingView (se símbolo/timeframe vierem do painel)
      if (window.updateTradingView) {
        updateTradingView(status.symbol, status.timeframe);
      }
    } // fim de renderPanel

    // ======= TRADINGVIEW WIDGET =======
    function updateTradingView(symbol, interval) {
      var container = document.getElementById('tradingview_container');
      if (!container || typeof TradingView === 'undefined') return;

      // Limpa o container antes de recriar o widget
      container.innerHTML = '';

      new TradingView.widget({
        autosize: true,
        symbol: symbol || 'NASDAQ:NVDA',
        interval: (interval && String(interval)) || '1',
        timezone: 'America/New_York',
        theme: 'dark',
        style: '1',
        locale: 'en',
        toolbar_bg: '#000000',
        hide_top_toolbar: false,
        hide_legend: false,
        allow_symbol_change: true,
        container_id: 'tradingview_container'
      });
    }

    window.addEventListener('load', function () {
      if (typeof TradingView !== 'undefined') {
        updateTradingView();
      }
    });

    // ======= LOOP DE ATUALIZAÇÃO (FETCH panel.json) =======
    async function loadPanelOnce() {
      try {
        const res = await fetch(PANEL_URL + '?t=' + Date.now(), {
          cache: 'no-cache'
        });

        if (!res.ok) {
          document.getElementById('status-text').textContent =
            'Erro ao buscar painel (' + res.status + ')';
          return;
        }

        const data = await res.json();
        renderPanel(data);

        // Atualiza status visual
        document.getElementById('status-text').textContent = 'Painel ativo';
        const headerTs = data.meta && data.meta.serverNow
          ? data.meta.serverNow
          : fmtTsUtah(data.timestamp || Date.now());
        document.getElementById('header-timestamp').textContent = headerTs;
      } catch (err) {
        console.error('Erro ao carregar painel:', err);
        document.getElementById('status-text').textContent =
          'Erro de conexão com painel';
      }
    }

    // Primeiro load + refresh automático
    loadPanelOnce();
    setInterval(loadPanelOnce, REFRESH_MS);
  </script>
</body>
</html>
